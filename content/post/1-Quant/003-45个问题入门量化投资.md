---
layout:     post
title:      "45 个问题入门量化投资"
subtitle:   "Learn Quantitative Investing with 45 Questions"
date:       2025-07-03
author:     "Xiangdi Wu"
image:      "/img/background.webp"
description : "本文通过45个问题，帮助投资者和量化初学者了解量化的基础认知。内容覆盖量化投资的基本概念、策略构建、风险管理以及实际应用等多个方面，内容浅显易懂。通过阅读这些文章，您还将了解到量化投资在现代金融市场中的重要性和应用前景。"

tags:
    - Quant

categories: [ "Quant" ]
URL: "/2025/07/03/learn-quantitative-investing-with-45-questions"
---

# 前言

很多人对量化感兴趣，但缺乏基础知识。这一系列科普文章会是很好的入门选择。

系列文章旨在提供一个全面而易于理解的入门指南。这些文章覆盖了量化投资的基本概念、策略构建、风险管理以及实际应用等多个方面，内容浅显易懂，无需任何先验知识。通过阅读这些文章，您还将了解到量化投资在现代金融市场中的重要性和应用前景。

# Q：量化投资与主观投资的同与不同？

从广义上讲，量化投资（Quantitative Investment）是一种以数据为基础、 以模型为核心、通常以程序化交易为工具的投资方法。

1）以数据为基础：一般来讲数据点及结构化数据越多则越有利于建模。如果历史上没有发生过或仅发生过几次，很难找到合适的数据来训练，基于过往总结出的“规律”则在这个阶段不一定有效；

2）以模型为核心：不管是早期以金融逻辑为基础的线性模型，还是后来更多采用的机器学习、深度学习模型，万变不离其宗——本质上都是以数据为基础建立模型；

3）通常以程序化交易为工具：“程序化交易”是一个工具，不管是主观投资还是量化投资，不管机构投资者还是个人投资者，都可以根据自身情况去评估和使用该工具。事实上，不论是量化投资的先驱爱德华·索普，还是早期的西蒙斯，在量化投资的初始年代，计算机技术发展还不够充分，所以很多采用电话等人工下单方式。即便到现在，量化投资也未必完全采用程序化交易实现，对于一些流动性不好的品种——D. E. Shaw的部分期权交易还是通过打电话咨询和下单。

作为一种投资方法，量化投资和主观投资一样，本质上都属于价格发现，捕捉市场错误定价、更好降低信息不对称、防范价格扭曲。两者殊途同归，并非完全对立，在不同周期、不同层面上挖掘市场的有效价格，只是采用不同的实现方式而已——前者侧重公开的结构化数据，后者侧重基本面深度调研。两类投资方法都是成熟市场上重要的参与者，都是不可或缺的部分。

无论采用哪种投资方法，要想持续取得长期靠前的超额收益，都要求抓住市场的本质规律，背后考验的是对市场的深刻理解，只是量化投资更侧重把对市场的深刻理解和最前沿的科学技术做有效结合。一般来讲，量化投资以捕捉短周期的市场价格信息见长，擅长纠正短期的价格偏离。而随着周期拉长，主观投资基本面深度调研相对更为有优势。以股票多头为例，无论主观还是量化，对投资组合均采用主动管理：以获得市场收益的同时获取超越市场超额收益；均可采用夏普比率、收益回撤比、最大回撤修复时间等基金绩效评价标准化指标分析。

# Q：程序化交易是量化投资的专属工具吗？

在提及交易工具时，我们也常看到“量化交易”的描述，但其易被误认为“量化的交易”，定义含糊。实际上量化投资也会用到手动交易，为了避免混淆，可使用更为严谨的“程序化交易”。

程序化交易（Automated trading）与“手动交易”相对应，指采用程序自动化决策来执行操作的交易工具，可同时交易成千上万种资产，而手动交易无法做到。

证券及期货等交易品种大致经历了传统交易、电子化交易、程序化交易三个阶段，1965年以前，包括交易所撮合在内的所有交易行为均依靠人力实现。上世纪六十年代的技术创新，特别是通讯技术的发展，推动了包括期货市场在内的资本市场的发展。电报这一新式通讯工具的出现使得期货交易摆脱了地理空间的限制；而电话的发明更加缩短了投资者、会员和交易所的通讯时间。在计算机技术普及后，世界各国的交易所纷纷改弦更张，使用计算机进行撮合成交。

量化投资也未必完全采用程序化交易实现。比如在发展初期也曾借助手动下单——20世纪70年代，量化投资的先驱鼻祖文艺复兴詹姆斯·西蒙斯在进行期货的量化投资时，那时计算机技术发展还不够充分，还是采用打电话给交易员，告知交易标的和数量等信息，实现在交易所平台的下单。即便到现在，国际顶级机构如D. E. Shaw在部分流动性不好的品种上（例如期权交易）还是会通过电话进行咨询和下单。

随着科技发展，程序化交易作为一种交易工具，能够快速捕捉机会和避免人为错误，可降低交易成本、提高交易效率，因此被更多的投资者们所选择。

事实上，不管是主观投资还是量化投资，不管机构投资者还是个人投资者，都可以根据自身情况去评估和使用该工具。在美国，不仅是量化投资机构，几乎90%以上的机构投资者基本都采用“程序化交易”的工具，包括主动管理中的主观投资龙头富达基金（Fidelity）、被动管理中的指数基金龙头先锋集团（Vanguard）等等。

程序化交易除了有利于投资策略的执行、促进机构投资者成为市场主力之外，还提高了市场的定价效率：高效的程序化交易让市场上金融工具价格的偏差在短时间内得到纠正，使其价格更接近其内在价值或其标的的内在价值，有助于稳定市场体系。

同时，程序化交易也增加了市场的流动性——高换手率交易策略程序在运行的过程中，随着交易信号的出现，限价指令不断形成、报送、执行和回报，与极其短暂的持仓相配合，形成流动性需求的同时，也释放了相应数量的流动性供给。流动性的增加使市场价值提高，吸引更多投资者加入市场，形成良性循环。

其中程序化交易的稳定性高度依赖计算机系统，对于计算机程序在交易接口速度、金融学和数学理论、计算机科学实践等方面都有很高要求。

中国证券监管相关部门在2015年就提出加强程序化交易监管的基本思路，针对程序化交易可能引发的风险，建立了部分监管规则和执法措施，以促进程序化交易有序发展。2019年颁布的《证券法》中规定，程序化交易须向证券交易所报告；2023年发布的沪深主板交易规则中增加了程序化交易报告制度的相关规定，明确程序化交易应当符合相关规定，并履行报告义务。2023年9月1日，证监会指导沪深北交易所制定发布《关于股票程序化交易报告工作有关事项的通知》《关于加强程序化交易管理有关事项的通知》进一步完善程序化交易报告与管理制度，维护证券市场稳定健康发展。

# Q：量化投资一般有哪些环节及哪些策略类别？

一般而言，量化投资可粗略分为7个环节：**收集数据、数据清洗、特征提取、模型开发、组合优化、回测模拟、交易执行。** 在收集数据这一环节，目前主流量化私募均不遗余力地加大投入，在数据来源很难做到独有或特别的差异化，而后面的6个环节，则几乎千差万别，背后考验的恰是管理人对市场理解的程度。随着时间推移，既有策略更完善，开发新因子的难度就越大。

  

很多文章在提及量化策略时会用到“高频”、“T+0”、“量价”等等，但这些术语并不准确严谨，海外把量化投资策略分为三大类：**高频策略、统计套利策略和基本面量化策略** 。

**1）高频策略**　

高频是相对于“非高频”的概念，在极短的预测周期里赚取买卖价差，具体预测周期的定义有些微差别，按海外惯例，预测周期一般“不超过5分钟”。

考虑到国内T+1和印花税的股票交易制度，真正优质的高频策略容量非常小众，基本上无法接受外部投资者资金发行资管产品，从规模占比上看对市场影响较小，也不属于主流策略。故讨论外资高频量化策略的影响时，更多还是以期货市场而非股票为主要场景：外资高频主要存在于实行“T+0”交易的中国期货市场，其中以Jump Trading为代表的外资高频交易商在硬件、策略、技术上具备明显优势。

需要特别提及的是，假设股票量化策略的年换手率约为100倍左右，其实相当于5天左右的平均持仓周期，实际是中频策略，而非高频策略。

**2）统计套利策略**

统计套利，指主要运用价格和交易量数据，借助数学模型和算法进行预测和风险管理，通过预测个股中短期股价的相对走势来获取收益。

这类模型通常在市场上寻找短期偏离合理价格较多的股票——做多低于合理价格的股票，卖出高于合理价格的股票——日积月累，以获得较为稳定的超额收益。这类模型的超额收益来源大部分来自对中短周期股票价格和交易量的研究分析，所以也常被称为“价量模型”。

比如，当市场有投资者因各种需要计划调仓卖出某个股票，但如果短期卖出较多，则会对股价形成短期冲击，进而造成股价偏离。量化投资机构通过对**市场交易数据及股票微观结构** 的分析，如果认为导致短期股价低于股票合理价格主要是受流动性冲击而非基本面变化，则会在一定的价格开始买入，从而使交易对手方能以更好的交易价格完成交易，为市场提供一定流动性的同时，也平滑了股价的大幅波动，而量化投资机构通过买入股票并持有直到股价回到均衡价格，在实现盈利的同时也提升了市场的定价效率。

海外著名的量化对冲基金比如文艺复兴、D.E.Shaw、Two Sigma ，Citadel LLC主要采用统计套利策略，**目前国内主流量化私募也多以统计套利为核心策略，预测周期从日内到几天不等，一般不超过10天。**

**3）基本面量化策略**

国内公募量化多采用**基本面量化策略，** 和传统基金经理价值投资类似，基本面量化模型会收集处理企业的所有公开信息，包括财务数据、经营数据、行业信息等等，然后挖掘数据背后的市场规律。基本面数据更新频率低，基本面量化策略持仓周期短则数月长则几年。持仓时间拉长，超额收益会降低，但策略容量能够大幅提升。

# Q：高频交易和算法交易、做市商交易的相通之处及区别？

**高频交易、算法交易和做市商交易都会大量采用程序化交易工具，这些概念基于不同分类标准，彼此之间有一定交集。**

**高频交易** 是相对于“非高频”的概念，在极短的预测周期内寻找市场流动性不均衡和其他短期价格无效机会，**赚取买卖价差而获利** 。不同机构对预测周期的具体定义可能有些微差别，但按海外惯例不会超过5分钟。高频交易通常会采用程序化交易工具，但也有极个别情况仍采用手动下单。

**算法交易** 虽也采用高频率下单，但仅为单边交易，这更多是交易执行精细化发展的结果，提供**以优化定单执行而非获利为目的** 的自动化交易执行，确定订单最佳的执行路径、执行时间、执行价格及执行数量的交易方法（如将大单指令分割成众多小单指令），力争高效平稳地执行其交易指令、实现最优交易结果，有利于平滑对市场的冲击、降低交易成本。

**做市商交易** 通过做市提供流动性，就像推动市场运转的润滑油，能促成交易、降低价差、达成更低的交易成本，从而帮助交易方实现其目标。在海外成熟市场，做市商还可获得交易所的返佣鼓励。在程序化交易出现之前，做市商交易主要依赖于交易员在市场里不停报单赚取差价；随着技术发展，除场外品种或极个别流动性不够的品种之外，程序化交易逐渐成为主流，手工做市逐渐淡出人们的视野。

作为一种典型的被动策略，做市商为市场提供流动性，并获取交易所的手续费折扣。在欧美市场，**做市商基本为高频机构** 。通常使用自动做市商系统的公司可能是交易所正规注册的做市商（具有报价义务），也可能是仅仅使用做市商策略赚取利润的独立公司（不具有报价义务）。目前，中国做市商制度仍处于早期发展阶段：银行间市场、股票期权、商品期权等市场均已引进做市商制度，新三板、科创板、北交所也先后引入了做市商制度。

# Q：何为换手率？换手率与业绩的关系？

换手率指投资组合在一段时间内转手买卖股票的频率，又被称为 **“持股周转率”，** 可以衡量投资组合交易频繁程度。业内提及时多指“年度双边换手率”，其计算公式为：换手率 =（卖出金额+买入金额）/ 资产规模。

**关于基金换手率与基金业绩的关系，** 业内也曾有过不少讨论，比如诺德基金FOF管理部曾统计2009年初到2018年中的偏股混合型基换手率与基金业绩的关系；国金证券研究所也对2010年-2021年上半年主动权益类基金产品分析样本进行过探究。在他们看来，

**1、对大部分基金而言，针对不同市场环境采取不同的换手率是较为普遍的做法。** 在市场风格切换较快、行业轮动较为频繁的情况下，高换手率基金的表现相对低换手率基金更好。

**2、从整体而言，调仓对基金的收益是有着正向贡献的。** 其中过于激进的调仓频率并不能取得最高的收益，而过于保守的调仓频率却会错失大量进攻的机会导致收益不及预期。因此，**保持适度的换仓有助于取得最佳的长期收益。** 

换手率的高低属于相对概念，换手率是投资过程的自然结果，而不是目标。更为重要的是股票换仓是否对基金净值或回撤控制做出正向贡献。**在基金选择中，投资者需要重点关注换手率与投资方法是否适配、换手率与管理规模是否适配。**

一般来讲，量化投资更为擅长对中短周期的价格纠偏，所以**相对来讲换手率会相对较高，这与量化投资的方法论密切相关** ——量化投资以捕捉短周期的市场价格信息见长，分散持有几百到数千只股票，相对优势更多体现在投资宽度，通过寻找大量数据间的统计规律对股票未来价格方向进行预测。**优秀管理人放弃胜率低的投资维度，积小胜而厚积薄发，** 通过捕捉中短周期的市场错误定价，力争将换手率转化为收益率。

目前国内主流量化私募资管产品中，中周期策略（年换手率约30-50倍左右）占比较高，短周期策略占比逐步下降。假设股票量化策略的年换手率约为50倍，其实相当于10天左右的平均持仓周期，实际是中频策略，而非高频策略。

在行业规模超过万亿元的背景下，**各家量化私募管理人倾向于采用与自己当前管理规模相匹配的换手率，** 同时给量化管理人的团队综合投研能力、底层策略积累深度，投研流程精细程度等方面提出了更高的要求。从行业观察来看，如果中周期积累足够深厚，可以做到既有较大容量、也能为客户带来相对不错的超额收益。

# Q：影响超额收益表现的因素有哪些？

“超额收益”指的是一个时间段内基金所产生的收益超过业绩基准的部分。

**1、超额收益的计算有两种方法：**

**“超额收益率 = 基金收益率 - 基准收益率”，** 这个方法是通过相减运算得出的，是目前较为常见的一种计算方法，但严谨度不够——在牛市时会出现高估，在熊市时则有所低估。

**“超额收益率 = 基金收益率/基准收益率-1”，** 又称为“相对收益”。

假设你年初买入1万元基金A，当前价值1.1万；又假设你年初没有买基金A，而是直接买对标指数，当前价值为1.05万，此时相对收益为1.1/1.05 - 1 = 4.76% ，这种算法相对更为公允，也是我们目前采用的方法。

**2、影响超额收益表现的外在因素：**

一般来讲，当市场处于**成交量大、波动率高、行情偏中小盘、高流动性成长股表现更好的环境中** 时，量化管理人的超额往往表现更突出；而当市场处于 **“风格急剧转换的阶段”** 或 **“一九行情”** 时，则对量化管理人相对不太友好，获取超额会比较难。

**“风格急剧转换的阶段”**

美国股票市场2007年8月和2020年3月，两次“量化黑天鹅”，都是历史上没有发生过或者很少发生过的。以疫情为例，对量化来讲很难找到合适的数据来训练，基于过往总结出的“规律”在当下不一定有效；

**“一九行情”**

只有少量股票涨，大部分股票下跌，这时候量化分散均衡的特点反而会变成弱点，这个时期的业绩表现可能并不如优秀的主观机构。比如A股2017年上半年的时候；

**受到外部环境影响，超额收益也存在天然波动，呈现一定的周期性** ——考虑到市场风格转换较快，α的周期大致在季度级别，股票量化模型出现几个月的超额回撤也属于正常范围；而β的周期约为2-3年，所以一般会建议股票多头的投资者持有三年以上的时间，淡化市场短期波动影响。

**3、影响超额收益表现的内在因素：**

**长期来看超额收益逐渐衰减是不可逆趋势，** 尤其是近年来A股市场有效性不断提升、行业竞争不断加剧，持续获取稳定超额的难度也在进一步加大，这已成为整个资管行业要面对的问题，也是机构化进程中的必然结果。

一般来说，股票多头产品长期收益的核心在于超额，而**超额收益则与管理人自身的综合投资能力息息相关——内在因素才是核心所在。**

**4、超额收益是主动管理型机构的安身立命之本，如何在不同的市场环境下跑赢市场，为客户提供长期价值是各家资管机构面临的课题，一般来讲，机构未来应在宽度和深度两个方面持续发力：**

**宽度：不断提升品种和策略的丰富性**

结合自身对市场的深刻理解，围绕“全周期、多策略、多品种”持续投入研究力量，储备更多低相关策略实现超额收益来源多元化。

除了全周期的的价量因子外，还可以持续对基本面因子进行深入研究，为将来做储备。另外，另类数据因子在海外较为成熟，但在国内目前仍属蓝海。

**深度：全流程的系统化、精细化**

持续对智力和算力的高投入，持续提升投研流程系统化和精细化程度。国内量化行业已进入高质量发展的新阶段，更加考验量化机构全方位的能力，在投资流程、运营服务、客户沟通、品牌建设等各个环节都要不断优化。

# Q：量化投资对股票市场有哪些影响？

2013年以后，量化投资在国内股票市场上的占比逐渐提高，特别是2018-2021年期间，量化机构管理规模增长速度较快，引发市场关注。由于量化投资领域在国内兴起较晚，本身也较为复杂，让人更想一探究竟：量化投资对股票市场有哪些影响?

**A、有助于增强市场流动性（中短周期）和提升定价效率（全周期）**

量化投资的本质属于价格发现，在不同周期上找到投资标的的合理价格，量化机构擅长提供中短期流动性：

在股票长周期上，主要通过对公司基本面数据的挖掘来找到股票合理价格，这部分和基本面深度调研驱动的主观投资相同；部分量化私募也积极参与定向增发、GDR等，提高中长期的定价效率，为优秀企业打造良好的募资环境，助力实体经济稳健向前。随着全面注册制推进，上市公司信息披露数据质量不断提升，量化可以更高效地探索股票基本面的内在价值，优化量化选股基本面模型的投资胜率，提升长期定价效率。

在股票中周期上，主要通过对市场交易数据以及新闻等另类数据的分析来找到股票中周期（一般在1-10天）上的合理价格。例如，当有投资者换仓时，特别是大型机构投资者调仓金额往往较大，需要多个交易日实现换仓，对个股中期流动性和价格造成一定冲击的同时加大个股波动，而量化策略通过对市场交易数据及股票微观结构的分析，如果认为导致短期股价低于股票合理价格的原因主要是受流动性冲击而非基本面变化，则会在一定的价格开始买入，从而使交易对手方能以更好的交易价格完成交易，为这一类机构投资者提供流动性——在降低个股波动的同时也获取一定收益。

在股票短周期上，主要通过对股票微观结构的分析找到股票短期的合理价格和提供短期流动性。由于美股市场以机构投资者为主，个人投资者交易占比长期低于10%，市场上缺乏天然的流动性提供者，美国股票市场的短期流动性90%以上都由量化机构提供，交易所还会以付费的形式补偿流动性提供者。

A股与美股的市场结构不同，即使在过去几年加速机构化的前提下，A股市场个人投资者的交易占比仍在50%左右，个人投资者给A股市场提供了大量的流动性，所以现阶段对量化投资机构提供短期流动性的需求并不是特别迫切。随着全面注册制的逐步深化推进，科创板和创业板中小型上市公司的数量递增，同时A股市场机构化程度逐步提升等综合因素影响，个人投资者交易占比会逐年降低。量化机构利用股票之间的相关性，可以给流动性不足的股票提供流动性，而流动性是所有资产估值的基础。

**B、有助于降低股票市场的整体波动率**

通过对公开数据的研究，当公司股价在短、中、长期偏离合理价格时，量化策略会买入低估和卖出高估的股票，让股价趋近于合理价格，在此过程中，价格发现功能的实现让市场变得更有效，量化机构在降低个股波动的同时也获取一定收益。数据显示，随着量化策略占比的提高，股票市场的整体波动率呈下行趋势。

从海外市场及国内A股的研究文献和实践结果来看，随着量化策略占比提升，市场有效性进一步提升，其整体波动率不增反而呈下行趋势。从个股来看，随着量化投资参与度的提高，股票连涨和连跌的概率也在下降，这也是市场有效性提升的体现。以美股市场为例，量化策略占比从2000年到2018年明显提升，波动率反而呈现下降趋势。最近几年，A股市场波动率逐步下降，2023年上半年年化波动率为13%左右，这正是包括量化机构在内的多类成熟投资者共同作用的结果。

目前A股量化机构的产品中量化多头的规模占比最高，在出现市场波动时，整体持仓较为分散且保持满仓稳定运行，每天交易买卖基本等量，并不会形成对市场的整体买压或抛压。甚至在市场剧烈波动时，量化多头产品实际上起到了稳定A股市场的作用。

当个股涨幅过高或跌幅过深时，量化模型里面占比较高的反转因子会促使模型反向交易，这抑制了个股过度上涨或下跌，让暴涨暴跌的概率降低。从我们自己的实证看，量化模型发现有持仓股票涨幅过大时会倾向于卖出，而股票跌幅过大时会倾向于买入，从而降低股票的波动率。当然这样会导致部分“追涨杀跌”的资金盈利大幅减少甚至无法盈利，从而也让市场更加有效。由此可见，“量化投资容易发生交易趋同”的观点并不成立——如果各家机构交易趋同，一定会导致过度交易的股票偏离合理价格，给市场上其他参与者提供反向交易的机会——从这个角度来说，量化策略成为了市场的反向“缓冲器”。

综上所述，量化选股模型在A股市场上起到了积极作用。同时我们也观察到，近几年随着A股市场逐步成熟，市场有效性加速提升，整体波动率进一步下降，获取超额收益的难度也大幅提升——这已成为整个资管行业要面对的问题，也是机构化进程中的必然结果。

# Q：如何理解和区分指数增强与全市场量化选股产品？

指数增强和全市场选股均属于量化多头产品，采用量化选股模型对投资组合进行主动管理。一般来讲，量化多头、量化对冲等产品线底层的模型框架是相通的，在同一套“量化选股”模型基础上做不同的选股限制及是否采取对冲等构建差异化产品线，以满足不同投资者的风险偏好。

**为什么先有指数增强后有全市场量化选股产品线？**

在国内量化发展初期，渠道和投资者对量化投资方法论的了解和接受程度远不如现在，各家量化机构在当时也没有很长的实盘公开业绩，相较之下，“指数增强”产品线的推广难度则要低很多：

一方面，公募量化在“指数增强”产品线上有一定的投教铺垫；另一方面，指数增强产品可拆分为指数收益（β）+超额收益（α），对于投资者来说，跟踪观察、收益归因、横向对比更为直观，尤其是“超额的夏普率”这一指标，能更好帮助投资者评估管理人投资能力的表现。

其中，系统性收益（Beta）来自于对指数的被动跟踪，基准既可以是上述的各类宽基指数，也可以是行业、主题及其他指数。超额收益（Alpha）则来自于主动管理，通过预测不同周期的个股相对收益，精选未来一段时间大概率能跑赢指数的个股，从而获取超额收益。

正因为早年投资者对量化投资方法论的接受度不高，而指增产品的横向对比和跟踪评估更为直观，量化机构在选股模型的优化器环节做相应的指数跟踪误差约束，进而形成不同指增产品线。常见的指增产品线有300指增、500指增、1000指增等，以相应的沪深300、中证500、中证1000等指数为基准做跟踪误差约束。

**为何多家量化私募力推“全市场选股”产品线？**

2021年下半年量化私募管理规模突破万亿，投资者对量化投资方法论的接受和认可逐步提升，市场竞争也更为激烈；随着A股机构化加深，市场有效性提升，获取超额收益的难度也随之提升，这也是市场竞争的必然结果。

以目前市场上最为主流的中证500指增产品为例，如果要控制跟踪误差，需要选取较高比例的中证500指数成分股，而中证500指数成分股交易量仅占整体A股的15%左右。随着量化私募的管理规模扩大，500指数成分股中量化私募的交易占比不断提升，逐渐高于其他股票——这使得中证500指数成分股α的下降相比其他股票更为明显，也较大影响了中证500指增产品的超额收益表现。

与此同时，具备一定风险承受能力的投资者大多更在意绝对收益。基于大部分客户的需求，近两年多家量化私募力推“全市场选股”产品线，力争在没有额外增加风险和波动的前提下，不受基准约束，也不做风格和行业的约束，按照全市场个股Alpha和流动性构建组合，目标是在实际交易约束条件下实现最大化绝对收益。目前，市场上各家全市场选股产品线的实盘业绩没有指增业绩这么长，但如果全市场选股产品采用的底层预测模型和指增产品相同，指增产品的历史业绩也可作为重要参考。

常见的风险因子包括市值、市盈率、市净率、流动性、残差波动率等。考虑到国内量化产品中多头产品线的规模占比最高，而对多头产品来说，放开风险因子约束并未显著增加净值波动，严控风险因子反而会对其Alpha因子的发挥有一定制约。

因此，在底层Alpha相同的情况下，不跟踪指数、放开自由度会带来明显更高的长期绝对收益，而并未造成多头产品波动率和最大回撤的明显上升，边际的改善较为显著。

换言之，不做约束的全市场量化选股才是最原始、最自然的——如果仓位越接近底层的Alpha，长期收益相对表现更好。如果采用某一宽基指数甚至更窄的行业指数做约束，反而限制了自由度，会很大程度上牺牲选股的超额收益，也就不能最大程度发挥量化选股模型的Alpha。

# Q：何为Benchmark？如何设置全市场选股产品的业绩基准？

业绩比较基准（Benchmark），是基金产品未来业绩表现的主要参考目标。一方面，它可以事前将风险收益特征传递给投资者；另一方面，业绩比较基准可以事后作为标尺辅助基金产品的业绩归因和评价分析。一般而言，获取超越Benchmark的超额收益（Alpha）是主动管理型机构的核心竞争力，如何在不同的市场环境下跑赢市场、为客户提供长期价值是各家资管机构面临的课题。

**如何设置全市场选股产品的业绩基准?**

机构通过在量化选股模型的优化器环节做相应的指数跟踪误差约束，形成不同指增产品线，对标指数自然成为其业绩标准，指数增强产品的收益可拆分为指数收益（β）+超额收益（α）。如果指数增强产品和指数的跟踪误差较小，对于投资者来说，跟踪观察产品表现、对产品业绩做收益归因以及横向对比都更为直观，尤其是“超额收益的夏普率”这一指标，能更好帮助投资者评估管理人的投资能力。

全市场选股产品则不受基准约束，也不做风格和行业的约束，按照个股Alpha和流动性构建组合，能最大化Alpha表现。

虽然全市场量化选股产品在模型层面不做约束，但仍然可以设置业绩基准，通常设定万得全A指数（全市场指数，涵盖沪深两市中所有的A股股票）为业绩参考基准。考虑到A股全市场选股产品持仓1000-1500只个股，而且因为中小市值股票Alpha较强，A股市场中小股票流动性也较好，一般情况下中小市值股票数量和市值占比较高，为了跟踪观察更方便、横向对比更直观，也可以将中证500或中证1000设为业绩参考基准。

**全市场量化选股产品线与主观多头的业绩更具类比性**

当下的个股分化行情中，不论大市值还是小市值板块中都存在投资机会，从这种意义上说，全市场量化选股产品线与主观多头的业绩更具类比性。全市场选股产品和传统主观多头均不对标任何指数，同为股票多头的两类产品，α来源虽有不同，但均可采用夏普比率（Sharpe Ratio）等基金评价指标进行分析。

![img](https://vamgbqkqg5.feishu.cn/space/api/box/stream/download/asynccode/?code=YzllNjQ1ZDMxNmY3Zjk3YmUxZDlhYzFlZjY5OGQ4NGRfWDREY1BtTXVpSlp2VE5Nd25RR1gyYk5ZQ2NSUFBUOE5fVG9rZW46RmRvR2JBRzVYb0hXQTh4c0VhRmM4ZWVhbkFjXzE3NTY4NDA2Nzk6MTc1Njg0NDI3OV9WNA)

**全市场选股和指数增强是二选一吗?**

一般来讲，“全市场选股”与“指数增强”均不做仓位管理，长期维持近满仓运作，同属于股票“量化多头”产品线大类——即采用量化投资的方式对投资组合进行主动管理，以获得市场收益（Beta）的同时获取超越市场的超额收益（Alpha）。但两者并非二选一，有着不同的配置价值。投资者不妨将自己的风险偏好和倾向纳入主要考量：

假设在某一阶段非常看好某一宽基指数（当市场中某个宽基指数阶段性强势的时候，全市场选股产品一般会弱于该类对标指数产品的收益），或者特别在意超额的波动率，投资者可以考虑选择指增产品。

对绝大部分投资者来说，如果目标倾向取得更好的长期收益表现，则可以考虑配置全市场选股产品。

# Q：量化等于对冲么？市场中性产品的收益预期和投资时机？

不少投资者易将“量化”和“对冲”混淆，实际上“对冲”并非量化机构的专属，主观机构也可以在产品中做对冲，以便对冲市场的系统性风险和行业自身贝塔。目前国内常用的对冲工具主要有：股指期货、期权、融券和收益互换等。

“股票市场中性”指的是产品线，其底层为“做多一篮子股票，做空一篮子股票或者股指期货以实现和市场涨跌无关的收益”。目前国内的市场中性产品以量化选股策略为主，但也有部分主观选股的中性产品。量化中性产品通过量化选股模型持有一篮子股票并借助各类对冲工具构建投资组合，实现股票市场Beta风险上无暴露或较低暴露，主要赚取超额部分（α）收益。

目前国内资管机构大多采用股指期货作为对冲工具，所以本文将主要介绍股指期货对冲产品的特点：

**一、股票市场中性产品收益影响因素及长期收益测算**

市场中性产品的收益影响因素：

- 基差，也就是股指期货相比大盘的贴水率，即对冲成本

- 股票组合相比大盘的超额收益

![img](https://vamgbqkqg5.feishu.cn/space/api/box/stream/download/asynccode/?code=YTFlNzU3MTcyZTY4YTk0OGFjZTk1NWQ2NTRhN2MzNmJfTEk0bGFnSXhWc294SXpaRTJDRUswYnYxZEtoQVVUNmtfVG9rZW46Umh2OGJvOFdrb2Fwb094QTNwOWNkV2FIbm1jXzE3NTY4NDA2Nzk6MTc1Njg0NDI3OV9WNA)

超额收益扣除对冲成本，再乘以资金使用效率就是对冲产品的收益。招商银行研究院私人银行部在《如何判断对冲基金的投资时机——兼论对冲基金收益预期》报告中，就市场中性产品费后长期收益拆解了测算过程：假定优秀管理人股票多头能跑赢市场12%左右；扣减约2.5%的对冲成本，再乘以平均85%的仓位，则对冲产品费前收益为8%；再扣除2%的费率（管理费1.5%+托管费0.25%+销售服务费0.25%），以及20%业绩提成——最终对冲产品的长期费后年均收益也仅约4.8%。而且通常首次认购还有约0.5%的申购费。

![img](https://vamgbqkqg5.feishu.cn/space/api/box/stream/download/asynccode/?code=MTM0YTdlYTExZWQ3OGFiM2MwZGZlZmE4NWNhM2YxMzJfNng3ZmJ0MEZxMTZpZ0xWMnFmQW90Y3ZCUkhNcUZ3ZU5fVG9rZW46VTVlWGJ1WEZTb0hzT1B4bFJ6cmNvQlVUbjM5XzE3NTY4NDA2Nzk6MTc1Njg0NDI3OV9WNA)

虽然任何时候都有业绩突出的对冲产品，但投资者对长期收益不宜期望过高。随着A股市场逐步成熟，市场有效性提升，长期来看股票端超额收益的逐渐衰减呈不可逆趋势。故上述测算市场中性产品长期收益4-5%，未来收益预期或进一步下降。

**二、股票市场中性产品的投资时机**

市场中性产品的业绩表现受两方面因素影响：一是管理人获取超额收益的能力，二是对冲市场风险所付出的对冲成本。超额收益要求投资者精选管理人，对冲成本要求投资者进行择时配置。选择市场中性产品的投资时机，主要考虑未来超额收益是否好做，以及对冲成本是否够低。

由于超额收益与对冲成本均会受市场环境影响，且超额和基差均体现一定的周期性，进而影响市场中性产品净值表现。虽然对市场系统性风险暴露较低，相对来说市场中性产品与权益市场的相关度也较低，但在超额收益出现回撤或者股指贴水修复较多时，市场中性产品同样也会出现显著回撤。

一般来讲当市场处于成交量大、波动率高、行情偏中小盘、高流动性成长股表现更好的环境中时，量化管理人的超额往往表现更突出；而当市场处于“风格急剧转换的阶段”或“一九行情”时，则对量化管理人相对不太友好，获取超额会比较难。

一般而言，在每次建立新的对冲头寸时，未来一段时间所要承担的对冲成本就已经确定，所以基差的波动带来的更多是短期的净值波动。股指期货升贴水只影响过程，不影响结果。如果短期内贴水大幅收敛，将造成已建仓产品净值的快速回撤，但是对于新资金却提供了一个很好的建仓时点。同时，对于已经待在产品中的投资者来说，虽然需要承受短期贴水收敛导致的回撤，但只要继续持有，向未来看去，随着贴水逐渐回到相对正常的水平，净值也会得到一定程度的修复。

当股指贴水成本较低甚至升水时，对投资者来说也是购入或者加仓市场中性产品较好的时机。但从更长的时间来看，升贴水本身是动态变化的，投资者应更为关注管理人的综合投资能力和超额收益表现。考虑到当前A股市场逐步成熟，市场有效性提升，投资者对市场中性产品的未来收益应有较为合理的预期。

超额收益扣除对冲成本，再乘以资金使用效率就是对冲产品的收益。招商银行研究院私人银行部在《如何判断对冲基金的投资时机——兼论对冲基金收益预期》报告中，就市场中性产品费后长期收益拆解了测算过程：假定优秀管理人股票多头能跑赢市场12%左右；扣减约2.5%的对冲成本，再乘以平均85%的仓位，则对冲产品费前收益为8%；再扣除2%的费率（管理费1.5%+托管费0.25%+销售服务费0.25%），以及20%业绩提成——最终对冲产品的长期费后年均收益也仅约4.8%。而且通常首次认购还有约0.5%的申购费。

虽然任何时候都有业绩突出的对冲产品，但投资者对长期收益不宜期望过高。随着A股市场逐步成熟，市场有效性提升，长期来看股票端超额收益的逐渐衰减呈不可逆趋势。故上述测算市场中性产品长期收益4-5%，未来收益预期或进一步下降。

**二、股票市场中性产品的投资时机**

市场中性产品的业绩表现受两方面因素影响：一是管理人获取超额收益的能力，二是对冲市场风险所付出的对冲成本。超额收益要求投资者精选管理人，对冲成本要求投资者进行择时配置。选择市场中性产品的投资时机，主要考虑未来超额收益是否好做，以及对冲成本是否够低。

由于超额收益与对冲成本均会受市场环境影响，且超额和基差均体现一定的周期性，进而影响市场中性产品净值表现。虽然对市场系统性风险暴露较低，相对来说市场中性产品与权益市场的相关度也较低，但在超额收益出现回撤或者股指贴水修复较多时，市场中性产品同样也会出现显著回撤。

一般来讲当市场处于成交量大、波动率高、行情偏中小盘、高流动性成长股表现更好的环境中时，量化管理人的超额往往表现更突出；而当市场处于“风格急剧转换的阶段”或“一九行情”时，则对量化管理人相对不太友好，获取超额会比较难。

一般而言，在每次建立新的对冲头寸时，未来一段时间所要承担的对冲成本就已经确定，所以基差的波动带来的更多是短期的净值波动。股指期货升贴水只影响过程，不影响结果。如果短期内贴水大幅收敛，将造成已建仓产品净值的快速回撤，但是对于新资金却提供了一个很好的建仓时点。同时，对于已经待在产品中的投资者来说，虽然需要承受短期贴水收敛导致的回撤，但只要继续持有，向未来看去，随着贴水逐渐回到相对正常的水平，净值也会得到一定程度的修复。

当股指贴水成本较低甚至升水时，对投资者来说也是购入或者加仓市场中性产品较好的时机。但从更长的时间来看，升贴水本身是动态变化的，投资者应更为关注管理人的综合投资能力和超额收益表现。考虑到当前A股市场逐步成熟，市场有效性提升，投资者对市场中性产品的未来收益应有较为合理的预期。

# Q：何为基差及如何影响市场中性产品的净值波动？

自2010年4月16日沪深300股指期货上市后，“基差”就一直频繁地出现在各类报告和市场中性产品的路演中。到底何为基差？基差表现又如何影响股票市场中性产品的净值波动？

股指期货，是指以股票价格指数为标的物的期货品种。目前国内有四个股指期货品种：IF、IH、IC 和 IM，分别挂钩沪深 300、上证 50、中证 500 和中证 1000 指数，其中，IM 于 2022 年 7 月 22 日上市交易。

“基差”，即现货与期货的价格差。基差能较好体现期货与现货之间的联动关系。若期货价格>现货价格，称之为期货升水，基差为负，将对对冲产品带来额外收益；若期货价格<现货价格，称之为期货贴水，基差为正，将对对冲产品带来负贡献。

基差或对冲成本是所有主要利用股指对冲的市场中性产品需要承担的风险。中性产品的净值波动主要受股指期货升贴水变动及管理人超额收益波动的影响，但近期股指期货贴水较小而且比较稳定。

建仓时即已锁定对冲成本；

在市场中性产品持有过程中，基差的收敛和扩散会阶段性影响产品净值波动；开仓后，基差的收敛或扩张变化会造成做空成本的浮盈或浮亏，进而对组合收益产生影响，但这只是中间持有过程的波动，不改变事先锁定的成本。

实际操作中，股指期货在开仓后并不会一直持有到期交割，而是在到期日之前平仓更换其他合约（移仓换月），以保证一直有仓位在对冲。因此，管理人通过对基差趋势的专业分析和建平仓时点的准确把握，可以对空头部分的做空成本进行优化以实现基差管理。对专业投资者来说，除了精选管理人，还可以依据升贴水变动对投资时机做择时配置。

由于超额收益与对冲成本均会受市场环境影响，且超额和基差均体现一定的周期性，进而影响市场中性产品净值表现。虽然对市场系统性风险暴露较低，相对来说市场中性产品与权益市场的相关度也较低，但在超额收益出现回撤或者股指贴水修复较多时，市场中性产品同样也会出现显著回撤。

目前量化中性产品本身仍具有配置价值，但是在股票端超额收益逐渐衰减、部分投资者对基差趋势缺乏专业分析能力，对市场中性产品投资时机难以把握的情况下，对于风险偏好较低、对回撤较为敏感的投资者来说，选择合适的多策略产品是不错的解决方案。

一般而言，“多策略组合”的底层策略有着各自独立的Pure α，通常以量化对冲为打底策略，在此基础上增加多个相关性较低的进攻型策略，依照目标波动率通盘考虑各子策略的风险预算、相关性、仓位占比，通过科学构建收益来源多元及分散的策略组合，则有助于提升产品收益风险比和客户持有体验。

# Q：何为年化波动率？与最大回撤的区别？

**如何区分和理解年化波动率和最大回撤?**

“年化波动率”是“夏普比率”的重要构成部分。一般来讲，夏普比率 =（年化收益-年化无风险收益率）/年化波动率。该基金评价指标反映的是风险调整后的收益率：一支基金在每承担一单位风险的情况下，可以获得多少超额收益。任何收益都与风险相伴相生，波动率可用来衡量资产收益率的不确定性，反映金融资产的风险水平。

最大回撤则是指“在选定周期内任一历史时点往后推，产品净值从最高点走到最低点时的收益率回撤幅度的最大值”，可以理解为“选取某一时段，产品出现最大的亏损比率”。假设某产品成立于2021年11月1号，2022年1月4号为净值短期高点，净值是1.2，那么到2022年4月26号，在历经A股暴跌后，净值一度跌到了0.9，达到了近期低点。这个时候，投资者可能遇到的最糟糕情况就是2022年1月4号买入，2022年4月26号卖出，亏损达 25%，计算方法为（1.2-0.9）/1.2×100% ，也就是持有期内该基金产品最大回撤为25%。

**年化波动率是统计方差 最大回撤是收益分布**

波动和回撤都是市场运行的一部分，从2007—2021年A股市场主要指数看，万得全A、上证综指、沪深300、中证500年度平均最大回撤分别为25%、24%、26%和29%，近五年，万得全A指数的最大回撤达到了34.37%。不同年度最大回撤幅度差异较大，参与市场的时点较为重要，而想要完美躲过每一次市场大跌几乎是不可能完成的目标。在产品实际运作过程中，影响回撤的因素较多，还需要根据具体情况分析。

年化波动率是衡量资管产品风险特征更为可评估和可参考的指标。年化波动率是统计方差，最大回撤是收益分布——数据点越多，出现极值的概率越大——即产品成立时间越长，经历极端行情次数可能越多，理论上最大回撤刷新记录的概率也就越大。因此，在评估周期并不够长的基金产品中，即使最大回撤较小，如果波动率较高，最大回撤的突破或只是时间问题而已。

**相较最大回撤的不可控 目标年化波动率则更为可预期**

通过考察同类中最优秀的对冲基金，不难发现：只要将产品的运作时间拉到足够长，最大回撤大致为年化波动率的1.5倍以上。

以一些运作时间较长的国际对冲基金为例：桥水Pure Alpha 基金目标波动率设为12%，实际实现年化波动率为10%左右，历史最大回撤为15.5%，发生在基金运作后的第20个年头；千禧基金实际年化波动率为4.3%，历史最大回撤为 7.24%，发生在2008年，即该基金运作第18年。对于运作时间还不够长的基金产品来说，采用“年化波动率”预估产品未来最大回撤表现，会比“最大回撤历史记录”更有指导意义。

对于投资者来说，年化波动率是考察多策略中低风险产品线的重要观察指标，从多视角评价风险控制表现和收益获取能力——即是否用可控的波动换取到预期的收益；而对于基金经理来说，需要依据产品的风险等级设定投资组合的目标波动率，并以此为指标来设定各子策略的风险预算及仓位占比。

相较最大回撤的不可控，目标年化波动率更为可预期。一般来讲，仅需三个月到半年左右的时间跟踪某基金产品的周净值，就足以观察出：是否按照基金经理设定的目标波动率运行而无太大的偏离。

综上所述，波动和回撤都是市场运行的一部分，投资者应理性看待产品净值表现，结合自身风险偏好、资金属性、投资经验等慎重选择符合个人风险承受能力的产品。

# Q：如何理解金融数据的复杂性及数据处理的重要性？

一般而言，量化投资可粗略分为6个环节：**收集数据、数据清洗、特征提取、模型开发、组合优化、交易执行。** 目前主流量化私募在收集数据这一环节很难做到多大的差异，而其他环节则几乎千差万别，背后考验的恰是管理人对市场的理解程度和技术能力。

以数据清洗和预处理环节为例，**数据数量和质量将直接影响最终投资组合表现，** 其中数据的数量则是制约机器学习模型训练和预测准确度的关键因素。数据清洗和预处理的步骤一般包括：**缺失值处理、 重复值处理、数据去极值、 数据中性化** （指消除数据中的某些因素对投资策略的影响，从而使策略更具普适性和可靠性。常见的中性化包括市值中性化、行业中性化、风格中性化等）、 **数据标准化** （如日期可能需要被转换为特定的格式）等。

**1、金融数据的复杂性：**

**低信噪比**

金融数据中噪音比例高，提取有效信号的难度较大，模型如果调整不够得当，就容易学习“噪音”。由于这一特性，量化投资在模型开发和调校时尤其强调避免过拟合。

同时，处理金融数据时要非常注重逻辑。以A股为例，不同股票具有不同涨跌停规则，此外新股上市以及复牌等行为都需要特殊处理，在逻辑的基础上对信息进行合理的挖掘、过滤、组合。

**时序单调性**

证券交易数据等时间序列有时序性（时间不可倒流），且金融市场时刻存在博弈，规律具有时变特性。量化投资方法论的目的是用历史数据预测未来，所以一定要避免未来信息的引入，并合理评估历史回测。

**2、金融数据的类别**

**1）按照数据格式分：**

**标准化数据**

常见的是截面、时间序列等数值类型数据，如交易所原始数据、原始行情及各类衍生出的价格、交易量、K线图等。普通投资者在炒股软件上看的分时图、K线图等数据也都衍生于交易所的原始数据，这些较为干净的被称为“标准化数据”。

**非标准化数据**

以**文本数据** 为主，包括财经新闻、财经论坛问答、卖方分析师投资报告、第三方机构提供的特殊数据等。这些数据里低相关非重大信息占比高，相比标准化数据会更复杂一些，所以被称为“非标准化数据”。为应用于量化策略开发，必须先对其进行数据清洗等**结构化处理** 。

**2）按照数据来源分：**

**价量数据：**

价量数据**包括一切能从市场交易行为中提取的信息** ，不局限于股票及其他资产的价格，以及衍生的各项技术类指标。包括**日间量价数据（日K）、日内量价数据（分时数据）、逐笔数据（股票的每笔成交和挂单数据）。** 其中日内量价数据的体量是日间数据的几百到几千倍，逐笔数据的体量可以是日间量价数据的万倍以上。

**基本面数据：**

既包括宏观基本面、产业链上下游发展、行业发展趋势等，也包括上市公司的财务报表如资产负债表、利润表、现金流量表等。

**主观投资在获取及处理基本面数据上拥有明显的相对优势，** 通过深度调研还可获取非公开非结构化信息——比如企业正在跟进或已经跟丢某个关键的大订单，或用卫星拍摄汽车生产公司的厂房，通过照片上特殊金属的反光程度大致估算存货。

**事件驱动数据：**

通过预测市场对特定事件的反应不足或过度反应，判断股票价格变化以获取超额回报。在金融领域，“事件”通常指“可能在短期导致投资者预期发生变化、对公司的基本面或其股票价格产生重大影响的情况”。比如：

**·股票回购和股东增持：** 公司回购股票或者股东一定规模的增持，往往代表内部人员认为股价低估，是给市场的正向信号。如果大股东和高管减持，会被认为是负向的alpha。

**·热点个股和市场炒作较多的股票：** 交易量突然增大并伴随大幅上涨，同时又没有基本面改善支持的股票，通常会在不久后大幅跑输市场平均，可作为很好的负向alpha因子。

**另类数据：**

另类数据是个相对的概念——当某种另类数据逐渐被市场上大部分参与者所接纳和使用时，就不再“另类”。目前来看，另类数据包括所有投资研究中使用的**非传统来源的新型数据** ，如ESG数据、社交媒体评论、卫星图像、移动设备数据、应用程序使用情况、互联网搜索记录和消费者交易数据等。

**另类数据研究在海外已拥有较为成熟的应用。** 另类投资管理协会（AIMA）与金融科技公司SS&C合作发布的报告显示，目前全球活跃的另类数据供应商超过400家，而1990年时只有20家。根据AIMA与美国银行的联合调查，目前约有一半的资管机构已经使用另类数据，且这一数量还在不断增长。

但在国内，由于金融市场发展阶段的差异性，具体表现为**获取难度偏大** （高价值数据获取难、易获取数据质量低）、**成本相对较高，非结构化数据的处理技术还不够成熟等** 原因，目前另类数据领域仍属蓝海。除了与多家数据第三方保持联动外，不少主流私募也在以较快的速度不断搜集、积累和持续探索另类数据，以寻找多元化、差异化的alpha来源。

另类数据较为分散、来源众多，在这里仅举几个简单的例子：

**·电商数据：** 电商会有各大类消费品的销售数据，根据这些数据和去年同期的比较和月度之间的比较，可以预测一部分消费类公司股票的未来销售和盈利情况。

**·商品期现价格和库存：** 通过商品现货期货价格和库存的数据可以对商品未来价格有一定预测，也可以用来预测原材料类上市公司的业绩情况。

一般而言，数据点及结构化数据越多，越有利于量化投资进行建模。如果某个大事件历史上没有发生过或仅发生过几次，基于过往总结出的“规律”在这个阶段不一定有效，也很难找到合适的数据来训练，进而影响置信度。目前国内主流量化私募的模型中价量因子占比较高，同时持续对基本面因子深入研究。随着量化行业的持续发展，未来各类因子都会提供非常重要的贡献。

# Q：历史回溯测试有哪些常见陷阱？

量化投资研究主要通过历史回溯测试。量化投资的研究工作就是不停地进行策略螺旋迭代，但稍有不慎就会落入陷阱，使得好不容易开发出来的看起来很完美的策略用真金白银投资后就出现亏损。

量化投资研究中最主要的陷阱有三个：幸存者偏差，使用未来数据，过度拟合。

1）幸存者偏差是误排除了目前已被退市或因其他原因消失的品种。将已淘汰的品种排除掉，只留下幸存者，也会使回测收益率偏好。在历史回溯时要特别注意，不能贪图数据处理的方便，直接用当前的股票池进行历史回溯，而是要切切实实地还原历史的情况，保留历史上每个时点的股票数据。

2）使用未来数据，简单说就是在历史回溯时穿越时空，把后来发生的信息也一起带回去了。比如，在年报公布前使用年报的市盈率，在收盘前使用收盘价。将未知当作已知，会使回测收益率偏高。因此要在回溯测试环境上构造一个数据过滤网，排除所有可能用到未来信息的数据，从源头上保证策略在回溯时不会用到任何未来的信息。

3）拟合是优化策略的重要方法，但过度拟合会使策略在回溯测试阶段其本身优异的表现无法在实盘上线后复现。一个策略，确定了基本的投资框架和交易规则之后还需要进行微调和优化，进一步提高收益并降低波动。这个微调优化的过程，就是拟合。过度拟合会使策略失去通用性，虽然能在历史回溯时拟合出非常漂亮的收益曲线，但并没有什么实际意义，毕竟我们不能真正地穿越时空去赚钱，投资还是要面向未来。解决过度拟合的方法主要是：参数不要太多，做好样本内测试和样本外检验，进行参数敏感性分析。量化策略应该是具有真实世界经济含义的投资逻辑，而不是根据一些试错法则穷举出来的结果，从而使模型可以覆盖过去以及未来更广泛的市场情况。

# Q：何为模型及过拟合？如何在模型训练中预防过拟合？

**一、何为模型？如何区分模型和算法？通用预测模型有哪些？**

一般而言，模型（Model）由数据及如何使用历史数据对未来数据进行预测的过程组成。而算法（Algorithm）指执行一种优化过程，即在训练数据集上让模型的误差最小化。

在机器学习领域，“机器学习算法”经常与“机器学习模型”交替使用——前者指的是在数据上运行以创建机器学习“模型”的过程，后者着重表达用于进行预测所需的规则、数字和任何其他特定于算法的数据结构。

在模型开发/模型预测、模型训练/预测值合并等环节中会将提取到的特征或Alpha因子进一步加工，得到“更优Alpha”。早期量化私募的模型开发以线性模型为主，随着非线性模型（如机器学习、深度学习模型）占比逐步提升，其模型复杂度、参数相比传统统计学习模型有了很大提升，预测效果也更好，量化机构整体投资能力获得较大进步——具体到如何精细化处理树模型、神经网络模型等也从侧面体现出各家研究深度和广度的不同。

量化投资的环节中所采用的模型大致可以分为三类：因子挖掘模型、预测模型和组合优化及交易算法模型。其中预测模型的发展总体而言是从简单到复杂、未来还要更复杂的迭代过程。目前，业内比较通用的预测模型包括：

 注重可解释性的线性模型：OLS

 统计学习、机器学习模型：Lasso、SVM、GBDT

 可端到端的深度学习模型：DNN、LSTM、Transformer、GNN

![img](https://vamgbqkqg5.feishu.cn/space/api/box/stream/download/asynccode/?code=MGI2MGZkZmUxMjc1YjJlYzVlYzAzNWU4N2M4Mzg0YmNfWUNRbkt1WnVUZVVRbXJKc0c1ZGxxMk90ZElxMEd1NDZfVG9rZW46QnBMcmJIZGlNb0p4WHZ4aE1naGNCTW5EblFnXzE3NTY4NDA2Nzk6MTc1Njg0NDI3OV9WNA)

**二、何为过拟合？如何在模型训练中预防过拟合？**

过拟合（overfitting）是统计学和机器学习领域的常用概念，可分为训练过拟合和回测过拟合两个层次。

训练过拟合是机器学习语境下偏狭义色彩的过拟合，指“机器学习模型在训练集上表现良好，但在测试集或新数据上表现较差”。产生原因是模型超参数选择不当或模型过度训练，解决方案通常是采用合理的交叉验证方法选择模型超参数。

回测过拟合是量化研究语境下偏广义色彩的过拟合，指“量化模型在回测阶段表现好，在实盘阶段表现差”。产生原因是市场规律发生变化，或者对回测阶段数据噪音的过度学习。回测过拟合难以根除，相对合理的解决方案是借助量化指标检验回测过拟合程度。

金融市场有不同的参与者，参与者也在不断进化。金融数据本身具有低信噪比、时序单调性。当模型过于复杂、参数数量过多、学习能力太强时，容易出现模型对于训练集以外的数据泛化能力差，表现为过拟合。

由于大多数机器学习模型并不是专门为金融时间序列开发的，这些模型在量化建模中的应用需要适时调整。所以将机器学习应用到量化投资领域时，在模型训练中如何预防和避免过拟合显得尤为重要，需要综合考虑预测精度、模型可解释性、模型鲁棒性和计算复杂性等因素。其中金融时间序列预测必须避免使用未来信息，有时更倾向于随着时间的推移将时间序列分成训练、验证和测试块，即进行前向验证，而非模型超参数优化中的交叉验证。

在深度学习中，超参数的选择对模型的训练和泛化性能有很大的影响——如果超参数过大，可能会导致模型过拟合，因此需要根据数据集和模型结构进行调整。这里的超参数是指那些需要手动设置的参数，这些参数不能直接从数据中学习得到，而需要通过持续调整和优化参数来得到最优的模型。

常见的超参数包括迭代次数（迭代次数指训练的轮数，过多的迭代次数则会导致过拟合，通常需要根据训练集和验证集的表现来确定）、正则化（通过惩罚模型复杂度来防止过拟合，常见的正则化方法包括L1正则化和L2正则化。需要根据具体问题进行调整）、丢弃率（丢弃率指在训练过程中随机丢弃一定比例的神经元，从而防止过拟合。过低的丢弃率会导致过拟合，通常需要根据具体问题和网络结构进行调整）等等。

需要特别提及的是，模型在回测与实盘中表现不一致是投资领域中普遍存在的现象，并不都是过拟合导致的，还可能与以下因素有关：

数据偏差：回测时使用的历史数据可能与实际市场环境存在一定差异；

滑点和交易成本：实际交易中存在的滑点和交易成本都应在回测时进行预估；

策略实现限制：在实盘交易中，策略实现效果可能会受交易执行速度、交易执行规模等因素的影响。

市场已发生变化：由于金融市场由不同参与者组成，投资者结构及投资者行为均会发生变化。金融市场还受整体宏观环境、政治和经济等因素情况影响。所以不同阶段市场运行规律会发生一定的变化，基于过去总结的有效规律在未来也未必有效。

# Q：何为策略容量及其影响因素？与头寸有何区别？

**一、 何为头寸?与管理规模有何区别?**

头寸（Position）也可称为仓位，指投资者在市场中所持有的某种资产或证券的数量或价值。股票头寸一般指投资者购买股票所使用的金额，其资金构成可以简单拆解为“本金+杠杆”，在股市交易中可分为“多头头寸”和“空头头寸”。

头寸规模要和策略容量相匹配。量化机构在美股市场普遍使用杠杆，机构更关心头寸规模，而非管理规模。国内情况则不太一样，以量化多头为代表的主流资管产品线，并未广泛使用杠杆；市场中性产品线的股票头寸大概在产品规模的80%——头寸规模一般略小于管理规模。

资管机构的管理规模通常需与其整体策略容量相匹配。一般来讲，随着规模上升，自身交易行为对市场的影响也会越来越大，且呈现非线性增长——期望通过历史数据获得这类影响的准确预估，具有相当大的难度——资管机构应及时关注自身规模增速，将策略容量与募资节奏进一步做好适配。

**二、何为策略容量?受哪些因素影响?**

策略容量一般指在一定收益预期下能容纳的资金规模。这并非一个固定的数值，而是基于收益预期的一个函数——如果预期收益下降，策略容量也会上升。

1）策略容量与策略本身特点有关：

股票高频策略：持仓周期在分钟级别，基于微观结构，超额夏普率高，但策略容量小。

高频策略指在极短的预测周期（按海外惯例不超过5分钟）里赚取买卖价差获利；考虑到国内T+1和印花税的股票交易规则，真正优质的高频策略容量基本上无法大规模发行资管产品，也并非主流策略。

日内统计套利策略：持仓周期在小时级别，日内价量预测，超额收益表现较好，夏普率较高，策略容量较小。

统计套利策略：持仓周期在日、周级别，短期价量和事件行为预测，超额收益表现中等，夏普率中等，策略容量中等。

基本面量化策略：持仓周期在月、季度级别，通过基本面数据预测长期股价变化，超额收益表现一般，夏普率较低，但策略容量大。

一般而言，策略预测周期越短，对滑点的容忍度越低，让渡冲击成本的空间就越少。原因在于：若持仓周期较短且换手较高，单次持仓收益预期并不高，而规模提升后，其交易成本占比的影响还将显著提升。

2）策略容量还与交易成本高度相关：

交易成本随资金规模呈非线性增长，而策略收益则随资金规模呈线性增长。在美国股票市场，交易成本主要是冲击成本，交易佣金相对可以忽略不计，其中承担做市商职能的机构还能拿到交易所流动性补偿的佣金返还。而在A股市场，随着规模增长，冲击成本甚至会超过印花税和交易佣金等直接交易成本。

由于冲击成本很难准确建模，如果短期规模增速过快，可能会导致对滑点及市场冲击的处理不够精细；而随着自身规模快速扩增，与市场的互动显著增加，基于历史数据的冲击模型的参考意义显著下降，由此影响超额表现。建议投资者更多关注规模的变化（特别是短期增速），而非规模量级本身，即“管理人的投资能力是否已经体现在当下的规模量级和净值表现上”。

不管是获取收益的能力，还是对滑点及冲击成本的精细处理，都与模型预测能力高度相关。换言之，策略容量的本质在于模型预测能力存在一定局限性。而通过扩大选股范围、扩增持股数量、拉长持仓周期，进一步丰富低相关收益来源，并持续提升投研流程系统化和精细化程度，都有助于预测能力的有效提升，从而提升策略容量；也可以选择清洗处理更高质量的数据，确保数据涵盖广泛的市场环境，优化模型参数，防止过拟合并提高模型的自适应能力，采用更为严格的回撤方法来交叉验证策略表现等方法。

目前，多家量化私募已积累了管理大规模资金的丰富经验，在如何设置交易滑点及有效应对冲击成本等方面，力争基于自身策略逻辑和特点积累大量有效数据持续进行策略优化。同时，搭建并完善丰富的产品线，以满足不同客户需求，将策略容量与募资节奏进一步做好适配，将客户风险偏好与产品风险收益特征进一步做好适配；而投资者也应对持有产品的风险收益特征进行深入了解，寻找与自身风险偏好和资金久期相匹配的产品。

# Q：量化投资如何进行风险管理？

**一、何为风险管理？**

资产管理是长链条业务，**广义上的** 风险管理不只是在**投研环节** ，也贯穿包括产品创设-资金募集-投资交易-估值核算-信息披露等**产品全生命周期运作过程** 。**狭义上的** 风险管理，是指通过对**敞口** 实施有目的的调整和规模控制，以提高**收益的质量和稳定性** 。

根据Markowitz的**现代投资组合理论** ，组合风险可以分为两部分：**系统性风险和个别风险** 。前者是指各资产因外部环境冲击所形成的**共振** ，对应着大部分资产出现同步下跌的情形，无法通过分散化投资来消除；而后者指单一资产波动给组合所带来的风险，可以通过**分散化** 投资来减少。比如多策略产品，可根据事先设定的**目标波动率** ，将风险配置于不同的策略类别，使风险水平整体保持在可承受的**预算** 范围内，通过对风险的跟踪与监控，进行子策略仓位分配及风险配置的动态再平衡。

**二、何为风险模型？**

一般来说，**风险管理会降低策略的盈利** ，**但也可以降低策略收益的波动性以及重大损失发生的可能性** 。Alpha模型用来追求收益，与之相对，风险模型用来控制风险。**在风险模型中** ，**需要更重视下行风险** 。

**风险模型的功能包括：**

**事后：** 分解和评价取得的收益

**降维：** 从对个股的预测减小到对因子的预测

**匹配：** 对纯因子组合的收益考察找到合适的因子

风险模型最直观的理解方式，就是把投资中面临的风险**拆解** 成一个个风险敞口，并分别预测各个敞口的风险，并合并汇总为总风险，从而得到对**总风险的预测** 。再根据预测的结果对模型匹配相应的约束条件，便可实现风险控制的目的。不同的风险模型的区别在于如何定义单个风险敞口，以及如何预测单个风险敞口的风险。

**其中** ，**最基础的风险模型是将投资的单个资产视为一个风险敞口** 。对于投资策略而言，投资标的不会只有一种资产，而是一个资产组。资产组风险与单资产风险之间**并非线性相加** 的关系（预期收益则可线性相加），取决于**三个因素** ：单资产风险、不同资产间的相关性和不同资产间的权重配比。

鉴于基本的风险模型并不能满足实际应用，结构化的多因子风险模型由此诞生。**多因子模型风险分解可以分为三类：市场风险** 、**行业风险和风格风险** 。其中**风格风险又包括：** 估值因子、成长因子、财务质量因子、杠杆因子、规模因子、动量因子、波动率因子、换手率因子、技术因子、改进的动量因子、分析师情绪因子、股东因子等等。

**三、量化私募的内部风控制度**

科学完善的内部风控制度，需要通过建立投资决策的**事前** 、**事中** 、**事后** 的具体监控措施，包括风险识别、风险度量、关健风险指标、风险限额设定等来实现风控目标。

对风险的最好控制就是**事前防范** ，在策略开发的过程中应将各种极端情况的参数引入策略中，比如通过分散投资来控制下行风险，再比如对全市场所有品种和合约进行实时监控，及时剔除流动性较差的品种和合约，在此基础上设计的策略能有效控制产品波动率表现；**产品运行后** ，当触及预设的风险指标（预警线/止损线）时，应当按照产品合同要求启动积极的风控手段，如降低仓位、增加相应的对冲头寸等。

# Q：何为风险敞口？如何理解和分配风险预算？

风险敞口（risk exposure）的书面定义通常为“指未加保护的风险，即对于风险未采取任何防范措施而可能导致出现损失的部分”，常用来指金融资产暴露在风险中的部分和受风险影响的程度。在股票量化中，常见的风格包括行业、市值等，当这些风格没有与指数进行对标时，就会出现风格敞口。

风险预算是指将投资组合的风险进行度量和分解，根据事先设定的目标波动率，将风险配置于不同的策略类别，使风险水平整体保持在可承受的预算范围内，通过对风险的跟踪与监控，进行子策略仓位分配及风险配置的动态再平衡。

传统的资产分配侧重于将资本分配至不同资产类别，而风险预算则聚焦将风险分配到子策略或不同资产类别，关注边际风险与权重；主要目标是平衡投资组合中的风险，使其符合投资者的风险承受能力、风险偏好等。风险预算的分配通常采用两种方法：

 自上而下法（Top-Down Approach）：在投资组合层面确定总体风险预算，根据各资产、策略或部门对投资组合风险和收益状况的预期贡献，将单个风险预算进行分配。

 自下而上法（Bottom-Up Approach）：先在资产、策略或部门层面确定单个风险预算，再将其汇总形成整体风险预算。这种方法可以更细致地了解投资组合中的风险驱动因素。

风险预算对获取绝对收益非常重要，为实现更精细化的风险管理，还需要考虑以下因素：

- 不同风险因子的配置

如股票市场的贝塔风险、风格和行业风险，债券市场的利率风险、久期风险、信用风险，如果做全球多策略，还有汇率风险等因素，均需在组合层面一并纳入风险预算考量。假设存在一个子策略是地产行业信用债套利，另一个子策略是能源行业信用债套利，表面看低相关，但实际上都暴露了信用风险。

- 极端风险下的共振

正常情况下，有不少资产和策略呈现低相关性。但在2008年全球金融危机这种极端情境下，绝大部分资金倾向降低风险偏好，降杠杆，追逐流动性，致使很多策略都出现高度相关性。在2022年，CTA子策略出现较大回撤、短期相关性较高时，风险集中在本质上单一的回报来源的管理人表现不佳，而风控优越、因子成熟、适时调整的管理人则表现平稳。对于这样极端风险下的共振，需要机构进行风险预算时保留足够空间，并动态调整。

# 多因子模型 8 问

## Q：什么是多因子模型？

多因子模型是市场上量化选股模型中主流的、应用广泛的模型。多因子模型中的因子是指能够刻画股票在某些方面的特征，并对股票收益的相对大小具有预测能力的指标。对股票收益的相对大小具有预测能力是指，因子值大的股票的收益应该比因子值小的股票的收益高。比如，用市盈率的倒数（EP）代表价值因子，EP 值越大表示估值越小、价值越高。长期或者在某一段时间内来看，EP 越大的股票，未来的收益可能越高，也就是 EP 这个指标对股票收益的相对大小具有预测能力。

因子刻画了股票某一方面的特征，因此在构造因子时，应首先确定该因子要代表股票的哪个方面的特征。比如，动量因子表示的是股票价格的趋势性特征，通常可以用最近一段时间的涨跌幅来计算。

每个因子都代表股票某一个侧面的特征，背后都是一条投资逻辑，代表成长性、估值、盈利质量等，并且都具有一定的预测能力。因子的数量可以有几十上百个甚至上千个，在因子数量很多的情况下，如果单独分析每个因子，不仅难以操作，而且效果不一定好。如果能综合考虑这些因子，将其整合为一个数值，就是通常说的 Alpha 因子，用这个 Alpha 因子代表多因子模型对股票收益的预测，并且使得 Alpha 因子对股票收益的预测比每个单独的因子更加准确和稳定。因此，多因子模型的目标就是整合许许多多的对股票收益具有一定预测能力的因子，取长补短，形成最终的 Alpha 因子代表模型对股票收益的预测，并且这个 Alpha 因子的预测能力比模型中的每个单因子都要好。最简单的整合方法就是直接相加，当然现在也可以通过机器学习等各种算法实现对多个因子的整合。

## Q：如何评价一个因子的效果

评价一个因子的效果通常有三种方法，分别是分组收益、IC 和组合优化收益。

分组收益比较简单。首先，每月月末按照因子值的大小排序将股票平均分成 10 组，分组的数量并不是固定的，也可以是 5 组或 7 组，分组的数量越多，越能深入分析因子的预测能力。然后，计算每组股票在下一个月的平均收益率，如果每组收益率的大小顺序与因子值的大小顺序相同，就认为分组收益具有单调性，分组收益越接近等差数列，单调性越强。分组收益单调性强的因子具有较强的预测能力，因为只要买入持有因子值大的那组股票，就能获得相对较好的收益。

IC 即信息系数（Information Coefficient），是股票的期初因子值大小顺序与股票期末收益率大小顺序的相关系数。IC 的绝对值越大，表示因子值的大小顺序与股票收益率的大小顺序的相关系数越高，即预测能力越强。IC 大于 0 表示因子值越大股票收益率越高，IC 小于 0 表示因子值越小股票收益率越高。举个简单的例子，假设有 10 只股票，如果某个因子的 IC 等于 1，也就是因子值的大小顺序与股票收益率的大小顺序完全正相关，那就意味着因子值最大的股票的收益率总是最高的。

如果不断增加分组收益中的分组数量，当每只股票就是一组时，这时的分组收益就变成了计算 IC，所以可以认为分组收益是 IC 的一种简化形式。

分组收益和 IC 这两种方法实际上都是简单地估计因子的预测能力，并且往往是高估的，并没有考虑实际交易中可能存在的交易限制对收益的影响。

通过组合优化收益的方式，加入实际投资中可能存在的交易限制，比如股票权重不能为负（也就是不能做空）、换手率不能太大（不能超过 20%）、行业偏离限制（比如行业偏离不能超过 2%）、风格因子上的偏离限制等，按照优化模型构造组合，计算这个组合的收益，就是最接近因子在实际投资中能够实现的收益。因子的优化收益越高，说明这个因子越有效，越能在实际投资中贡献收益。

## Q：为什么有些因子的超额收益不理想

有些因子的分组收益和 IC 都很高，为什么实际投资时超额收益却很不理想？

分组收益是先将股票按照因子值大小排序后分组，然后计算每组的平均收益率，并分析分组收益的单调性。IC 是计算因子值的大小顺序与股票收益率的大小顺序的相关系数。分组收益的单调性越高，IC 越高，表明因子的预测能力越高，但为什么实际投资时超额收益不理想呢？主要原因是分组收益和 IC 往往高估了因子的预测能力。在给股票分组时，如果没有剔除一些交易受限的股票，比如长期停牌的股票复牌后可能连续涨停或跌停，连续涨停的股票实际上是很难买入的，每月调整分组时也不会考虑换手率的限制，因此这样计算得出的分组收益是失真的，实际投资效果会大打折扣。计算分组收益时，需要注意用来分组的样本空间是不是可交易的，要注意剔除一些交易受限股票的影响。

IC 计算的是因子值大小顺序与股票收益率大小顺序的相关系数。因子值越小，股票收益率也越小，即使在因子值越大而股票收益率并没有越大的情况下，IC 值也会比较大。但在实际投资中，A 股只能做多不能做空，因此买入的组合通常都是因子值比较大的股票，而这个因子恰恰对因子值比较大的这部分股票的预测能力较低，导致实际投资的股票组合的收益率不高。虽然整体 IC 比较高，但其实是被因子值比较小的股票拉高了，而这部分的收益在实际投资中往往拿不到，这种情形就是通常说的「空头收益不可得」。因此，在分析因子的 IC 值时，要注意观察 IC 是不是空头部分贡献的，如果空头部分贡献的占比过高，就不是一个好的因子。

## Q：如何找到那些简单有效的因子

在寻找或挖掘因子的方式上主要有两种思路：一种是先有投资逻辑，再寻找相应的指标来刻画这个投资逻辑，并检验这个指标的有效性，同时不断对指标的计算公式进行调整以改进指标的预测能力；另一种是直接挖掘指标与股票收益率之间的规律，而不关心这个指标所代表的经济含义，只要这个指标具备预测能力即可。第二种方式的指标计算公式往往比较复杂，也难以有一个直观的理解。

在多因子模型中，第一种是主流的方法。多因子模型中的大部分因子都是建立在投资逻辑的基础上的，具有明确的经济含义，比如价值因子和成长因子。采用这种套路寻找因子，就需要不断地积累投资逻辑，投资逻辑简单来说就是「如果……，就……」的关系，比如如果股票具有某种特征，收益率就会比较高或比较低。投资逻辑可以通过阅读投资大师的著作、研究学术报告、与同行交流、观察市场运行规律等方式来获得。提炼出投资逻辑后，还要将这些投资逻辑指标化，这也是量化投资最主要的工作。将投资逻辑用量化的方式进行定义，转化为具体的公式和数字，也就得到了因子或指标，接下来就是检验这些因子的预测能力。在大多数情况下，通过简单方法得到的因子的预测能力并不高，有可能是指标的计算公式或数据不能完全反映投资逻辑，这时候就需要对计算指标的公式和所采用的数据进行修正和调整，让指标能更加准确地反映投资逻辑，提升预测能力。当然也有可能是这个投资逻辑本身就是不成立的，或者预测能力本身就不高，这时就需要对投资逻辑进行甄别。

在第二种思路中，比较常用的是采用机器学习或数据挖掘的方法挖掘因子。首先，输入各种类型的数据：可以是基本面的数据，比如营业收入等；也可以是行情数据，比如收盘价、成交额等；还可以是新闻舆情等。然后，由机器进行训练，寻找这些数据与股票收益率之间的相关模式，用来预测股票的未来收益。这种方式不关心背后逻辑，也不探究因果关系，只追求在样本内构建函数提升拟合度，这样可能会有一些未知的问题。因此，机器学习作为一个工具，需要谨慎使用。

## Q：挖掘因子过程中需要避哪些「坑」

在挖掘因子或开发量化模型的过程中经常会遇到一些「坑」，比较突出的有幸存者偏差、使用未来数据、过度拟合等。

大多数人都听过幸存者偏差，也知道它的意思，但可能都没有认真想过这个偏差的影响会有多显著。比如，我们用沪深 300 指数的当前成分股来进行回测，从现在的成分股中计算因子值，然后回测其在历史中的表现。由于指数每半年都会进行成分股调整，留在指数中的股票一般都是好的股票，这会使回测结果比实际结果好。要避免踩「坑」，就要用到时点数据（Point in Time，PIT 数据）进行回测，要按照数据当时公布的状态如实记录，不能事后去修正。比如，股票 A 在上年年底的时候退市了，有的回测数据可能就会把股票 A 从数据库中删除，在回测的时候就永远不会选到它，但这种处理显然不合理。如果用 PIT 数据，就要如实地保留股票 A，因为在它发布退市公告前我们并不知道股票 A 何时会退市，是有可能会选到这只股票的。

前文提到，使用未来数据也称为「前视偏差」，就是在回测中使用了当下还未公布的数据。最常见的是财务报告，上市公司的年报通常是第二年的 3、4 月份才会公布，而报告期都是前一年的 12 月 31 日，做回测的时候很容易在第二年的 1 月份就引用了这些年报数据，比如净利润；或者间接引用这些数据，比如计算市盈率时采用的净利润。避免使用未来数据的方法也比较简单，就是在回测时坚持使用 PIT 数据。

此外，过度拟合是一类经常遇到的坑，也是量化投资的致命风险，特别是一些可以设置参数的指标。比如动量指标，可以用过去 20 天的收益率来定义，也可以用过去 50 天的收益率来定义。在某一个时间段内，总是能找到一个最优的参数，比如 30 天，使得在这段时间内的动量指标具有最高的预测能力，但往往过了这段时间这个参数的动量指标就不管用了。过度拟合问题与提高预测精度在样本内并不容易区分，通常需要通过样本外的检验进行判断，如果样本内表现很好而样本外表现很差，往往就是因为样本内过度拟合了。通常来说，指标的参数越多，就越容易存在过度拟合的问题。

## Q：多个因子如何组合成 Alpha 因子

多因子模型中的每一个因子都代表股票某一方面的特征，数量不少的因子最终要组合成单一的 Alpha 因子，在最终合成 Alpha 因子之前，首先需要将指标合成因子。

股票的每个特征都可以用多个指标来刻画，比如动量因子，可以是 20 日的涨跌幅，也可以是 1 年的涨跌幅，哪个指标更能代表动量因子呢？这时候，往往将按照不同周期的涨跌幅计算的指标简单求和作为动量因子。当然，这些指标在合成动量因子之前都是要做标准化处理的，合成后的动量因子也要再做标准化处理。

刻画同一特征的指标在合成因子时可以简单求和，主要是因为这些指标之间往往具有很强的相关性，它们之间的区别可能就是参数不同。但是代表不同特征之间的因子在组合成 Alpha 因子时，简单求和不一定是最好的方法。

不同的因子代表不同的投资逻辑，不同的市场环境所适应的投资逻辑也有所不同，因子的预测能力也往往是有周期性的，因此根据因子的预测能力的大小赋予因子不同的权重，即 IC 加权，IC 值高的因子权重也大，从而提升 Alpha 因子的预测能力。当然，如果既看重 IC 值的大小，也看重 IC 值的波动，可以考虑根据 ICIR 来进行加权。ICIR 的计算类似基金的 IR（信息比率）公式，由 IC 的均值除以 IC 的标准差得到。

## Q：如何不断叠加新的因子

在已有 Alpha 因子的基础上，如何不断叠加新的因子？

股票每个方面的特征，都对股票收益的相对大小具有一定的预测参考价值，一个有效的多因子模型应该含有数量较多的因子，且这些因子所刻画的股票特征之间的相关性应该是比较小的。

多因子模型的优势就在于能够综合考虑股票方方面面的特征，取长补短，获取整合优势。因此，不同的因子之间的相关性要低，否则如果两个具有高相关性的因子实际上就等价于一个因子重复多次，对 Alpha 因子预测能力的提升不但没有帮助，反而会增加 Alpha 因子在股票某个特征上的暴露，从而丧失多因子模型的整合优势，增加风险。

因此，如果已经有了一个比较成熟的多因子模型，在叠加新因子时，就相当于组织要接纳新成员，既要考察这个新因子本身的预测能力，也要看新因子与已有多因子模型中的因子的相关性，最重要的考量是要能提供增量信息，比如带来了新的投资逻辑或者新的数据处理方式。在新因子 IC 值不低的情况下，如果与原有因子的相关性比较低，就可以作为新的成员直接加入；如果与某个因子的相关性比较高，可以与已有的因子组合，甚至可以直接替换已有的因子。

## Q：因子会失效吗

使用多因子模型的目标是整合多个对股票收益具有一定预测能力的因子，取长补短，最终组合成 Alpha 因子，代表模型对股票收益的预测，那这个多因子模型会一直有效，可以「躺赢」吗？

要牢记投资中没有永恒的「圣杯」，多因子模型也不例外，并不存在永远有效的模型。多因子模型由许许多多因子组成，每个因子代表不同的投资逻辑，每种投资逻辑都有其适应的市场环境，因此多因子模型中的某些因子暂时失效是很正常的事情。多因子模型的优势是整合，由许多因子组合成 Al-pha 因子时已考虑到因子失效的情况，在赋予预测能力高的因子更高的权重时，也就是给予失效的因子更低的权重甚至权重为 0，自然而然地就降低了这些失效因子对 Alpha 因子的影响。

既然已经认识到多因子模型不能一劳永逸，那研究者日常的工作就是不断地往多因子模型中补充新的因子，替换已经明显失效的因子，丰富多因子模型中的因子库。因子越多，覆盖的投资逻辑越多，越能发挥多因子模型的整合优势。

投资有风险，收益有波动。多因子模型最终得到的 Alpha 因子虽然也可能会遇到短暂的回撤，但只要是真正的多因子模型，包括许多相关性低的因子，那么，由多个因子组合成 Alpha 因子的加权方式就能够真正给高预测能力的因子更高的权重，这样的多因子模型就具有自适应能力，在短暂回撤之后会自动调整及时走出低谷，继续发挥多因子模型的优势。

# Q：何为因子？通常如何分类？

**一、因子的定义**

投资者可能经常听到这样的描述：“挖掘因子”，“对因子库的持续丰富和迭代”…… 那“因子”究竟是什么？如何界定“因子”以及分类？

在量化选股中，因子是指“对个股收益差异有解释作用的特征”，能够解释投资组合的收益或帮助进行资产定价。因子的有效性主要看预测能力。一个因子被验证为有效，是在某历史时间段内的数据所呈现出来的规律，并不意味着该规律在未来的市场中可以持续有效。

**二、因子的分类**

因子的种类很多，不同类别的因子能从不同的维度对个股收益差异进行解释。在量化选股模型中，一般可分为“风险因子”与“阿尔法因子”：前者更强调风险来源，解释能力还是很强，但已经缺乏预测能力；后者更强调回报来源，更注重是否能预测未来个股相对收益。

风险因子早期也属于阿尔法因子，只不过很早就被学术界挖掘并公开发表论文，尤其在美股，其收益风险比快速下降——但这些因子还是能够解释很多收益，只是预测能力几乎消失，所以被称为“风险因子”。常见的风险因子包括市值、市盈率、市净率、流动性、残差波动率等。

“阿尔法因子”一般指能较为稳定贡献超额收益的这类因子，其构建相对较为复杂，或数据来源比较独特。一般来说每家机构的阿尔法因子都有所不同，呈现低相关性。

以美股为代表的海外市场和A股市场在运行机制、发展阶段、投资者结构、融资成本及约束等方面都存在较大差异，因而在如何处理阿尔法因子和风险因子方面有所不同。比如海外量化产品以“市场中性+杠杆”为主，考虑到风险因子通常会带来较大波动但不能同时带来显著收益，所以资管机构在建模过程中会尽量减少风险因子的暴露；国内量化产品中则是各类量化多头产品线规模占比最高，对多头产品来说，放开风险因子约束并未显著增加净值波动，严控风险因子反而会对阿尔法因子的发挥有一定制约。

阿尔法因子按数据来源可分为价量因子、基本面因子、事件驱动因子、另类数据因子等。

**价量因子**

价量因子又可按照预测周期分为短周期价量因子和中长周期价量因子，短周期多指高频和日内因子，中长周期一般持仓周期在1-20天左右。目前，中周期价量因子在A股的配置占比较高。

**基本面因子&事件驱动因子**

根据引发股价反应的时间跨度差异，又可以分为偏短周期的“事件驱动因子”与偏长周期的“基本面因子”——前者包括财报发布、盈利预增、预计扭亏、突发事件等，后者一般包括估值、成长性、盈利质量等。

目前基本面因子占比也在逐步提高。但对量化私募来说，进一步大幅提升基本面因子配置比例仍有待时机。目前国内量化私募总体管理规模在整体市场的占比仍较小，价量为主的策略还能贡献较好的收益风险比；私募商业模式收费整体高于公募，要求私募管理人提供更好的收益风险比产品以获得投资者的青睐。

**另类数据**

另类数据因子在海外发展较为成熟，但在国内目前仍属蓝海。头部量化私募除了与多家数据第三方保持联动外，自己也在收集并持续探索以获得更多突破。

**三、“因子同质化”现象并不存在**

量化投资的盈利来源非常多样化。如上所述，既有微观结构数据驱动的高频因子（国内属于非主流）、交易数据驱动的价量因子、基本面数据驱动的基本面因子，又有事件驱动因子，以及另类数据因子。由于各家量化机构在方法论、模型、团队架构等方面均存在差异，投资组合优化及最终实盘交易行为都非常多样化。

从A股主流量化机构的超额数据分析可知，去掉交易量、波动率、离散度等影响量化超额的共同因子后，各家机构的超额相关性并不高，更不存在所谓的“因子同质化”——海外市场的数据也支持这一结论。主要原因是各家Alpha的交集部分大多用来克服印花税、佣金和冲击成本，而体现业绩的往往是各家比较独特的Alpha因子。此外，从逻辑上说，如果各家机构交易趋同，一定会导致过度交易的股票偏离合理价格，反而给市场上其他参与者提供反向交易的机会，从而导致“交易趋同”不成立。

当然，量化私募管理人仍需持续开发和丰富底层因子，提升策略进化效率和加深对市场的理解，在投资组合层面持续优化模型，挖掘培养优秀人才。目前，各家量化管理人围绕加速融合量化基本面、重视另类数据的应用、基于阿尔法策略微观结构做进一步解构、全周期多策略多品种等方向深入探索，取得了不错的进展和效果。

# Q：什么是因子标准化和中性化？

不同的因子代表股票不同方面的特征，具有不同的计算方法和数值单位，比如市值的单位是元，量级是亿；PE 是比值，没有单位，数量级是个位数或两位数；ROE 是资产收益率，单位是百分比。多因子模型的目标是综合考虑股票多个侧面的特征，最终得到能对股票收益进行预测的 Alpha 因子，如果因子值的单位和数量级都不一样，是无法直接进行加减运算的。当各指标间的量级相差很大时，如果直接用原始指标值进行分析，就会突出数值较高的指标在综合分析中的作用，相对削弱数值较低指标的作用。为了实现多因子模型的目标，需要对模型中的每个因子进行标准化处理，统一因子的单位和数量级，让因子之间能够公平地进行互相比较和加减运算。

最常用的标准化处理方法也称作 Z-Score 方法或者正规化方法，计算过程是：首先，求出指标所有原始数值的均值和标准差；然后，将每个原始数值减去均值后再除以标准差。公式如下：

$$y_i=\frac{x_i-\bar{x}}{s}$$

其中，$\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i$; $s=\sqrt{\frac{1}{n-1} \sum_{i=1}^{n} (x_i - \bar{x})^2}$

在进行标准化处理之前，通常会先做去极值处理，以避免极端值的影响，处理方法一般是将明显极端的数值直接剔除或者替换为某个临界值。经过标准化处理得到的数据符合正态分布，即均值为 0，标准差为 1，超过 99% 的数据会落在[-3，3]区间之内。经标准化处理后的数据并不会改变原始数据的相对大小关系，也就不会改变指标对股票收益的预测能力。将多因子模型中的所有因子都进行标准化处理后，就能进行加减运算得到 Alpha 因子了。

中性化是在标准化处理的基础上进一步排除某些因素的影响，最典型的例子是市值中性化和行业中性化。通常是采用线性回归的方法，将目标因子作为被解释变量，将市值和行业作为解释变量，回归得到的残差就是剔除市值和行业的影响后的因子。比如，成交额这个指标与市值的相关性很大，市值大的股票通常每日的成交额也大，如果直接将成交额和市值两个指标放入模型中，其实有很多重复的信息，对提升模型的预测能力帮助不大，需要对成交额进行中性化处理，提取成交额指标中的增量信息。

# Q：什么是特征？与因子的区别？

**一、特征与因子**

因子指“对个股收益差异有解释作用的特征”；其中，Alpha因子更为强调其对未来个股相对收益的预测能力。特征指“被观测对象的可测量性能或特性”，通常是数值型的，但语法模式识别可以使用结构特征（如字符串和图）。

“特征”更侧重符合数理统计规律的信息，“因子”相对更侧重逻辑性和可解释性。一般来讲，中低频数据能直接提取Alpha因子，不少低频指标本身就具有选股能力；而原始的高频行情数据一般不能直接用作Alpha因子，需要通过信号变换、时间序列分析、机器学习等方法从高频数据中构建特征，才能构建选股因子。

一般而言，量化投资可粗略分为6个环节：收集数据、数据清洗、特征提取、模型开发、组合优化、交易执行。其中“特征提取”环节，各家称呼并不相同，简单的Alpha因子和简单的特征工程处理都在这一环节进行。

在机器学习领域，“特征工程处理”是指在给定数据、模型和任务的情况下设计出最合适特征的过程，相当于梳理数据并结合业务需要提取有意义的信息，以干净整齐的形态进行组织。

做好特征提取能节省大量后续环节的工作：以D. E. Shaw为代表的部分海外顶级机构，并未特别强调深度学习模型的复杂性，但由于Alpha因子质量较高，即使并不复杂的模型也能获得出色的建模效果。这也是为何业内并不会片面强调因子数量，因子的质量（即存在多少独立的Alpha）才是关键。不同的方法论会得到不同的成果，从逻辑出发的因子质量比较高，暴力方式得到的因子数量比较多。

近年来，A股市场更为有效、机构化趋势明显，量化私募获取超额收益的难度增加，因子开发也面临着数据维度更高、信息密度更低、噪声含量更高的挑战。机器学习等擅长处理海量数据和高维特征的方法得以快速应用到量化投研流程中。其中深度学习模型具有灵活多样的网络结构，适合不同情景的建模问题，本身具有自动学习特征的能力。随着网络层数增加，模型的线性和非线性表达能力也会在一定范围内明显增强。

随着人工神经网络的进一步发展，除了选择分析已经提取好特征的信号，还可以直接分析原始数据而不需要提取特征。该做法能避免人为选择导致的信息丢失，保留全部信息，最终有助于获得相关性极低的α。

**二、量化机构的迭代方向：**

**第一类：追求更新的方法论**

例如在特征工程方面，增进对数据的深刻理解，“把对市场的深刻理解和最先进的科学技术相结合”。简单的因子提取和连接并不能增加收益，不同维度的多元化拓展是未来努力的方向——虽然目前另类数据在中国A股的应用并不广泛，也未能大幅增加策略的超额收益，但发展前景广阔，仍值得持续积累并投入研究。与自然语言学习不同，股票市场本身的数据点不够多，只堆砌数据必定导致过拟合。优秀的研究员从理解出发，依靠逻辑型的因子（如事件驱动因子）也能进行数据分析，发掘他人想不到的东西。

**第二类：侧重更新的模型、更高的算力——依靠模拟和近似人的行为试图替代人的理解**

2017年，Google的研究者提出 Transformer 的神经网络模型，这启发了全球量化机构进一步的科技应用。如果应用更新的模型，Alpha挖掘能力可能比以前提升幅度更大。以深度学习为代表的“暴力”方式非常重要，在诸如神经网络做几层、怎样做才不会过拟合的细节问题上也是不同机构的分野，这也是“采用同一个模型，业绩却千变万化”的原因。

除了对基础设施等硬件进行资金投入外，量化私募还需要努力营造有利于高效产出的投研环境，为优秀顶尖人才提供相对较优的福利待遇，兼顾硬实力的提升和软环境的升级。

# 多因子风险模型 6 问

## Q：多因子风险模型的原理

风险模型本质上也是一个股票定价的过程，因为股票承受了风险，所以需要风险溢价来补偿。风险的定价模型也经历了不同年代的发展。最开始，美国学者威廉·夏普、约翰·林特尔等人于 1964 年在资产组合理论的基础上提出资本资产定价模型（CAPM），主要研究证券市场中资产的预期收益率与风险资产之间的关系以及均衡价格如何形成，是现代金融市场价格理论的支柱。该理论认为，单个证券的期望收益由两部分组成，无风险利率与所承担风险的补偿，也就是风险溢价。市场的风险溢价是市场的预期回报率减去无风险回报率，而证券的风险溢价的大小取决于证券相对于市场组合的 Beta 值，衡量的是单个证券的系统性风险，Beta 值越高，单个证券风险越高，那么所得到的补偿也越高，即预期收益率也越高。

CAPM 相对比较简单地描述了证券的预期收益和市场组合预期收益的关系，史蒂芬·罗斯于 1976 年提出了套利定价模型（APT 模型）。APT 模型认为，套利行为是现代有效市场（市场均衡价格）形成的一个决定性因素。如果市场未达到均衡状态，就会存在无风险套利机会。APT 模型用多个因素来解释风险资产收益，根据无套利原则得到风险资产均衡收益与多个因素之间存在（近似的）线性关系。

APT 模型虽然在形式上很完美，但是由于没有给出具体驱动资产价格的因素，并且这些因素可能数量众多，只能凭投资者经验自行判断，且每项因素都要计算相应的 Beta 值，而 CAPM 模型只需计算一个 Beta 值，所以在对资产价格估值的实际应用中，CAPM 比 APT 的应用更广泛。

1993 年，尤金·法玛（Eugene F. Fama）和肯尼斯·弗伦奇（Kenneth French）采取了完全不同的方式来解释资产的收益。他们既没有假设理性投资者，也没有假设市场中不存在套利的机会。Fama-French 三因子模型起源于两个被大家发现的定价现象：一是小市值的股票平均收益率更高；二是低市净率（PB）的股票收益率更高。之后，尤金·法玛和肯尼斯·弗伦奇通过公司金融的数据把股票按照市值和市净率的高低分成 25 个投资组合（市净率从高到低 5 档，市值从高到低 5 档），得到了基于市场、市净率、市值的三因子模型。

## Q：多因子风险模型的因子

经过 Fama-French 三因子模型的启示，也就是市场因子、市值因子和市净率因子能够解释一部分资产的预期收益率，一些金融巨头开始研究能够影响股票预期收益率的因素，我们把这些因素定义为因子。

2011 年，摩根士丹利资本国际公司（MSCI）发布了相对完善的 Barra 多因子风险模型。该模型包括国家因子、10 个风格因子和 30 多个行业因子，相对于 Fama-French 三因子模型又增加了很多因子。

国家因子比较好理解，如果投资标的都是一个国家的股票，那么所有股票的国家因子都是 1。

对于行业因子，一般来说，不同行业的股票走势差异会非常大，每个行业的业务范围、产业政策、发展方向都不尽相同，在国民经济和民生中所处的地位也不一样。因此，股票的行业分类对股票的未来收益率的影响差异很大，显著性非常强。比如，某只股票属于白酒行业，可能最近几年的表现非常好；如果是建筑、建材、纺织服装等行业，可能过去两年的表现很差。

Barra 多因子风险模型包括市值、Beta 值、动量、残差波动率、中市值、价值、流动性、盈利、成长和杠杆共计 10 个风格因子，每一个风格因子都描述了股票的某一个维度和属性，而这个属性能够对股票预期收益率产生显著的影响，这个影响可以为正，也可以为负。

举个例子来说，在 2017 年之前，小市值因子明显对股票预期收益率有正向影响，即市值小的股票有更大的概率走势好于基准；2017 年之后，小市值因子对股票预期收益率的影响方向发生了变化，即市值小的股票有更大的概率走势弱于基准。类似地，我们也经历过价值因子失效的阶段，之前具有低估值特性的股票表现好于基准，说明低估值能够对股票预期收益率产生正向影响，但是 2019 年下半年之后，市场更青睐估值相对高、成长性好的股票，低估值反而与股票预期收益率有负向关系。所以，我们称这些风格因子为风险因子，即这些因子确实能够对股票预期收益率产生显著影响，但影响的方向可正可负。

总结来说，Barra 多因子风险模型就是集合了多个对股票预期收益率有显著相关性的因子，包括国家因子、行业因子和风格因子，通过线性回归模型来研究这些因子对股票预期收益的影响。

## Q：如何构建多因子风险模型？

上面在介绍 Barra 多因子风险模型的时候已经提到，Barra 多因子风险模型包括国家因子、10 个风格因子和 30 多个行业因子。这些因子能够解释股票的部分收益，而不能被这些因子解释的收益称为个股特异性收益或个股的残差收益，是每只股票自身的因素导致的，无法用这些系统性的因子解释。因此，一个完整的多因子风险模型包括系统性的风险因子，如国家因子、行业因子、风格因子及个股特异性部分。

可以把因子的概念细致化一些，因子包括因子暴露度和因子收益率，怎样理解这两个概念呢？首先看因子暴露，以市值因子作为例子，每只股票都有自己的市值，各不相同，这些股票各自市值的数值就是市值因子的暴露度。为了量纲的统一，会把这个因子暴露的数值做标准化处理，使得因子暴露度主要分布在-3～3。而市值因子作为风险因子，一个单位的风险暴露度对应的风险溢价或者说风险补偿就是因子收益率。假如有一天，市值因子的风险溢价是 1%，也就是说因子收益率是 1%。如果某只股票的市值因子的暴露度为 1，那么市值对股票收益率就贡献了 1% 的收益；如果另外一只股票的市值比较大，市值暴露度为 2，那么它的市值就对它的收益率贡献了 2% 的收益。因此，首先需要理解因子暴露度和因子收益率。刚才提到市值因子，有些人会认为市值因子暴露度就是股票的市值，然后标准化。那么市值因子的因子收益率是怎样得到的呢？在实际应用中，可以通过线性回归的方式估计因子的收益率。

举个例子，第一天计算好各个因子的因子暴露度；第二天知道了所有股票的收益率，把个股因子暴露度和个股的收益率做线性回归，估计出各个因子暴露度的系数，这个系数就是对应的因子收益率。而系数的显著性就是因子对股票收益率影响的显著程度，数字绝对值越大，说明这个因子对个股收益率影响越显著。通过回归模型，还可以得到无法被系统性因子解释的个股特异性收益率。每天通过回归计算因子的因子收益率和个股的特异收益率，就能够得到因子收益和个股的特异收益的时间序列，进而也能够计算因子之间因子收益率的协方差矩阵和个股特异收益率的波动率。由此可见，我们基本上是通过多因子风险模型「庖丁解牛」，把股票的收益率和波动完全分解了。

在构建投资组合时，往往是在一个大的股票池中在一定约束下精选部分股票，那么在优化中需要计算整个股票池所有股票收益率的协方差矩阵。由于股票数量众多，传统协方差的估计很困难，会面临估计精度差、参数敏感等问题。通过风险模型的分解，可以把所有股票的收益率都分解为系统性的因子收益率和特异收益率，因此可以利用因子收益率的协方差矩阵和个股特异收益率得出股票的协方差，因为因子的个数相对股票个数更少，这样得到的股票协方差难度更小、精度更好。

## Q：风险模型的协方差矩阵和个股残差风险

在风险模型中，因子协方差矩阵和个股残差风险的估计是重点和难点。主要根据历史数据来估计因子协方差矩阵和个股残差风险，估计的前提是获得了每日的因子收益率和个股残差收益率数据、有了比较完整的历史数据。

首先看因子协方差矩阵的估计。我们有国家、行业和风格等共计 40 多个因子的因子日收益率，可以按照传统计算协方差矩阵的方式计算协方差。考虑到与计算日相隔较近的数据可能影响更大，可以在计算中赋予其更高的权重；与计算日相隔较远的数据可能影响较小，赋予其相对更低的权重。通过计算发现，因子收益率的时间序列存在自相关性，即今天的收益率可能会影响明天的收益率，需要进行一些调整，降低这种由于因子收益率存在自相关性造成的估计偏差。而后在进行组合优化时发现，对部分优化组合，估计的协方差会低估或高估，因此进行特征根调整，一步一步最终形成相对比较成熟的因子协方差矩阵估计方法。在个股的残差风险估计中也会用到类似的调整方法。个股残差风险存在一些新的问题，需要采用相应的方法进行处理，比如有些个股停牌了，没有收益率数据；有些股票被 ST（特别处理）了，有一些特殊性；有些新股历史数据不够长等。最后发现，个股残差风险估计的结果会高估波动率高的股票组，会低估波动率低的股票组，因此采用贝叶斯压缩估计的方法进行修正。发现问题并逐步改进后，形成了相对较好的个股残差风险的估计。在估计完成因子收益率、因子协方差矩阵、个股残差收益率和个股残差风险以后，就可以利用这些信息进行投资组合优化。

## Q：如何评价一个风险模型的优劣

前面主要以 Barra 多因子风险模型作为风险模型的例子进行剖析，投资者其实可以按照自己对市场的理解，找到能够影响股票未来收益的一些因子来构建自己的风险模型。那么，评价一个风险模型优劣的因素有哪些？

1）解释度，即模型中的因子能够解释多少股票收益率的变化。一般用 R2来表示，R2越大，说明模型中的因子越能够解释股票收益率的变化，模型拟合股票收益率的效果越好。如果所选的因子不能解释股票未来收益率，风险模型就失去了意义。

2）各个因子的显著度。不能一味地增加因子的个数，以期获得更高的解释度，在添加任何一个因子到回归模型时，都要确保该因子在其他因子存在的情况下仍然能够对股票收益率产生影响，即该因子能够提供增量信息。另外，各因子之间不能有较为明显的相关性，如果因子存在共线性，拟合得到的参数波动就会非常大，失去正常意义。

一般来说，在风险模型中，风险因子的数量并非越多越好，在样本内拟合的 R2也并非越高越好，样本内的过度拟合可能会造成样本外的表现比较差。因此，在保持拟合精度的情况下，因子越少，样本外的鲁棒性（系统在不确定性扰动下，具备保持某种性能不变的能力）可能越好，即模型更不容易失效、稳定性越好。综合来看，评价一个风险模型的好坏可以从多个维度入手，比如模型的解释度、因子的稳定性和显著性、模型样本内外的表现差别等。

## Q：风险模型有哪些用途

前文介绍了风险模型的主要组成，包括因子暴露度、因子收益率、个股残差收益率，也通过数量化的方式在时间序列上估计了因子收益率、个股残差收益、因子协方差矩阵和个股残差风险，对个股收益率做了一个比较详细的分解。正是由于这些分解，把研究全市场 4000 多只股票的收益率的问题变成研究因子收益率和个股残差收益率的问题，大大简化了研究的维度，提高了参数估计的精度。那么，风险模型在实际投资中有哪些应用呢？这里举几个常见的应用案例。

1）组合的风险敞口控制。在介绍风险模型时提到过，这些因子既可能对股票收益率带来正向影响，也可能在某些阶段带来负向影响。那么，为了使得投资组合免于受到这类风格或行业因子的影响，可以把这个风险敞口设置为 0，即整个组合不暴露该风格，或者说风格的暴露度为 0。这样无论该风格因子的因子收益率如何，都不会影响组合的相对表现。另外，通过控制组合在风险因子上的暴露可知组合偏向于哪些风格、规避了哪些风格，让投资者对自己的投资组合有更加深刻的认识和了解。

2）组合归因分析。如果已知组合的风险暴露在哪些行业因子、哪些风格因子上，就能根据这些因子的表现知道组合的表现。反过来说，可以对投资组合做归因分析，比如某投资组合在某个阶段表现好，可能的原因是某个因子近期表现好，而该组合刚好比较多地暴露了这个因子。

3）组合优化。风险模型使得在大股票池中直接做组合优化精选股票成为可能。对组合优化的简单理解是：某投资者想在一个股票池中选出一些股票，这些股票既要有较高的预期收益，又不能暴露太多风险，比如行业上不想偏离太多，怕踏错行业，风格上可以按照自己的经验判断偏离方向和程度；如果管理的产品是指数增强基金，不想太多偏离自己的基准指数，那么就要控制组合对基准指数的跟踪误差。鉴于以上这些方方面面的约束，都需要用到风险模型，从而完成组合优化，得到符合投资者要求的精选股票组合。

# 组合管理 6 问

## Q：组合管理模型的作用

组合管理模型的作用是打通策略研究和投资交易，将个股 Alpha 模型转化为投资组合模型，输出一组股票的权重数据。量化投资的 Alpha 模型虽然可以从多个维度给市场中的每只个股进行综合打分、评价每只个股的相对好坏，但无法将研究成果直接转化为投资组合。量化投资模型注重分散化，以组合而不是个股的方式进行投资，这样的组合通常包含数十只甚至数百只股票，无法用人力进行逐一挑选和决定权重。因此，量化投资者需要借助组合管理模型完成从 Alpha 模型转化为投资组合的过程。这个模型以个股 Alpha 收益为输入，从样本空间中进行选股，参考基准指数的个股权重、风格暴露、行业权重，同时考虑交易限制，控制换手率，以排序选股、组合优化等方式，最终生成一个包含目标组合中每只股票权重数据的清单。与传统的主观投资不同的是，量化投资者在投资交易时直接以组合的形式进行交易。

## Q：投资组合构建方法的进阶史

组合构建有多种方法，并且逐渐在进化。

1）最简单的组合构建方式是排序选股。得到个股 Alpha 收益后，在样本空间中将个股按从大到小直接排序，选择前 N 只排名靠前的股票。进行加权时，通常采用等权或者市值加权的方式，即每只股票同等对待或按照市值大小赋予权重。这种方法的优势是可以非常直接地选择 Alpha 收益高的股票，但缺点在于没有对组合的风格暴露、行业权重进行限制，容易造成与基准指数大幅偏离。

2）市值中性或行业中性分层选股。方法是首先在样本空间中按照市值或行业进行分组，在每个分组中按照 Alpha 收益进行排序，然后选择前 N 只排名靠前的股票，最后组成一个组合，在加权时首先给每个分组与基准指数分组相同的权重，然后在分组内再次进行等权或市值加权。这种方法的优势是兼顾了 Alpha 收益与基准特征，构建出的组合与基准指数偏差较小。

3）利用优化器，控制组合与基准在风险因子暴露度、行业权重等方面保持相同，在此前提下最大化组合的 Alpha 收益，可以更好地进行风险约束。

4）结合风险模型，在优化时加入对组合预估风险的考量，利用哈里·马科维茨的现代投资组合理论最大化风险调整后的 Alpha 收益。这样得到的优化组合不仅可以满足多种约束条件，还可以在预期收益与风险间取得平衡，现在大部分量化投资者都会采用这种组合构建方法。

## Q：如何高效地实现组合优化

组合优化的理论基础是哈里·马科维茨的现代投资组合理论，投资本质上是在不确定性的收益和风险中进行选择。投资组合理论用均值-方差来刻画这两个关键因素。均值是指投资组合的预期收益率，是单只证券的预期收益率的加权平均，权重为相应的投资比例。方差是指投资组合的收益率的方差，刻画的是投资组合的风险。投资组合理论的核心观点是理性投资者应该追求最大化风险调整后收益，即如果给定预期风险水平，就应该追求预期收益最大化；如果给定预期收益水平，就应该追求预期风险最小化。如果把组合的预期波动率作为横坐标，把预期收益率作为纵坐标，就可以画出一条曲线，叫作有效边界，表征在不同风险下的预期最大收益。在实际投资过程中，量化投资者需要利用优化器完成组合优化，优化器可以由团队研究搭建，也可以采购国际专业机构发布的优化器产品，如 Barra 模型、Axioma 模型。另外，在实际投资过程中，量化投资者需要给组合优化过程加入大量的约束条件，如组合换手率、个股权重偏离、风险调整系数、风格因子和行业因子偏离度等，使最终组合满足投资需求。

## Q：组合优化的输入和输出是什么

以指数增强策略为例，组合优化需要输入多个参数。

1）需要输入个股的 Alpha 收益，由 Alpha 模型得到。

2）需要输入策略的样本空间，一般指数增强策略虽然可以在全市场进行选股，但是需要限制指数成分股权重不低于非现金资产权重的 80%。

3）需要输入可交易空间，仅有样本空间是不够的，由于某些股票无法进行交易或者风险过高，需要剔除。

4）需要输入基准指数的权重，因为指数增强策略必须对标某个基准指数，必须严格控制投资组合与基准指数的偏离。

5）需要输入各类约束条件，如跟踪误差、风格因子、行业因子、换手率、基准内行业权重、个股权重偏离、总主动权重等，目的是控制组合跟踪误差。

6）需要输入风险模型中每只个股在风格因子上的暴露度、行业因子上的暴露度、残差风险以及风险因子的协方差矩阵，以便优化器估计组合的风险。

7）优化器的输出是一个清单，其中包括每只股票的权重。所有个股权重和为 1，股票数量通常在几十只到几百只。

## Q：组合优化通常会做哪些风险控制

1）限制换手率。一般来说，换手率越高，投资组合的费前收益率越高，但如果考虑交易成本，收益率反而有可能下降。因此，需要控制换手率，避免无效交易和过度交易。

2）控制风格因子暴露度和行业权重偏离度。在风险模型中，组合的风险由风格风险、行业风险和残差风险决定。残差风险通过分散化降低，风格风险和行业风险通过控制因子暴露度降低。比如，市值因子是一个很重要的风格因子，不同市值的股票收益率相差很大，组合优化时要进行重点控制，与基准指数保持一致。再如，对行业权重一般要进行中性化约束，假设基准指数中消费行业的权重较高，组合中消费行业大幅度低配或超配，就会导致形成比较大的收益率偏差。

3）控制个股权重偏离度。个股权重偏离越小，组合越分散化，与基准指数的偏离越小，残差风险越低，可以通过控制组合的总主动权重进行控制。

4）跟踪误差。因为风险模型可以预估投资组合的风险，所以优化时也可以直接对跟踪误差进行约束。最后需要说明的是，风险控制需要适度，要在收益与风险中找到平衡。如果风险控制得太严，投资组合与基准偏离太小，则能产生的超额收益也会很低；而如果风险控制的比较松散，投资组合与基准偏离太大，投资收益不可控，既有可能大幅跑赢，也有可能大幅跑输。

## Q：组合优化中常见的问题

问题一：优化器在一般情况下都有解，但当约束条件太严格或者两个约束条件产生冲突时，则可能导致优化器无解。比如，要求某个因子正向偏离基准 3 暴露度，全 A 股样本空间中，所有股票的市值因子暴露度在 ±3 之间。如果在优化的样本空间中，没有因子能达到正向偏离 3 暴露度，自然就不可能构建出组合。还有一种情况，两个约束条件产生冲突，比如同时要求组合在某几个因子上达到一定暴露时，如果因子暴露要求比较极端，能达到要求的股票数量本身就比较少，而能同时达到多个要求的组合则可能不存在。

问题二：约束条件没有起到作用，这是由于优化器中的约束条件分为两种：硬约束，软约束。硬约束是指必须满足的约束，如果无法满足则导致无解；软约束是非必须满足的约束，如果不能满足不会导致无解，优化器仍然会产生输出，但此时约束无效。

问题三：Alpha 预测与风险预测的量级不匹配。由于优化器的目标函数是风险调整后收益，其中需要设定一个系数。如果这个系数过大，就会导致目标函数中预期收益太小，无法起作用，则优化目标纯粹变成最小化风险。如果这个系数过小，就会导致目标函数中预期风险太小，也无法起作用，则优化目标纯粹变成最大化收益，完全不考虑风险。

# Q：何为优化器？如何理解组合优化在量化投资的作用？

**一、何为优化器？**

优化器是预测信号到目标仓位之间的重要桥梁，在这一过程中收益预测、风险预测及交易成本等共同作为优化器的数据，再根据产品目标完成持仓权重的优化求解。

在优化器中，根据不同的预测周期和产品线所对应的优化目标采用不同的选股限制，最终实现在约束下最佳的目标仓位。量化多头（包括指数增强、全市场选股）、量化对冲等产品线底层的模型框架是相通的，都在同一套“量化选股”模型基础上构建差异化产品线，以满足不同投资者的风险偏好和投资需求。

**二、何为组合优化？**

在金融学中，组合优化的起源可以追溯到20世纪50年代美国经济学家Harry Markowitz 首次提出的投资组合理论（Portfolio Theory），他对均值-方差分析方法、投资组合有效边界模型进行了系统深入的研究，并因此获得1990年的诺贝尔经济学奖。

Harry Markowitz 认为，投资者在进行资产配置时，需要考虑不同资产之间风险和收益的关系，才能使整个投资组合达到最优状态，实现相同期望风险水平下的期望收益最大化，或是相同期望收益水平下的期望风险最小化。这一理论为现代金融发展奠定了基础，组合优化的思想也逐渐应用于其他领域，为优化问题的解决提供了新思路。

**三、组合优化在量化投资中的应用**

一般而言，量化投资可粗略分为6个环节：收集数据、数据清洗、特征提取、模型开发、组合优化、交易执行。

广义上，组合优化（Portfolio optimization）包括从预测信号到交易的过程中所有的工程细节。

狭义上，组合优化就是在股票市场中结合上游提供的预测信号和其他输入（如风险模型、交易费用模型等）给出每个时点希望交易的仓位，即将收益预测转换为持仓权重的步骤。

组合优化是运筹学的一个重要独立分支，通过对数学方法的研究寻找离散事件的最优编排、分组、次序或筛选。目前，组合优化算法主要分为四类——即数学优化算法、启发式算法、元启发式算法和机器学习方法。其中，组合优化问题的机器学习求解范式可以分为基于端到端求解和局部改进求解。

构建组合一般分为两个步骤：确定拟配置的投资标的、分配各个标的的仓位权重。合理的组合存在但不唯一，譬如不同风险偏好类型的投资者对待同样的组合，适配程度一般不同。因此，投资组合本身不存在最优解，是综合考量后的次优解。

在量化投资中，组合优化用于计算考虑约束条件时能达到的目标函数的最大值，产生具体的仓位权重。在优化器的设置上，需要首先确定优化目标和约束，后续调整则是动态的、不断循环往复的过程——可以简单理解为“持续地跑回测，收到分析结果，再反馈调整”。

1）优化目标

不同管理人在不同产品线上的优化目标往往不同，常见的优化目标包括：最小化组合波动（方差）、最大化组合收益、最小化与基准指数的跟踪误差和最大化组合的夏普比率等。在不同的优化目标下，即使是同一套“量化选股“模型，产品业绩或呈现出截然不同的风险收益特征。

2）约束

在约束上，包括行业约束、风险约束、个股约束等都是需要重点考虑的参数：

 行业约束：不仅可以针对所有行业设置配置比例的上下限，还可以单独对个别行业进行个性化的设置。

 风险约束：可手动调整某些参数配置，如某因子的权重，控制风险暴露能够更好监测因子在实际投资中可能出现的表现。

 个股约束：从流动性限制和市值限制两方面着手，前者有助于降低调仓过程中的交易滑点，后者主要考虑“持股比例触及举牌线”等问题——以避免引发不必要的关注或过度解读。

# Q：股票交易的执行方式和交易成本

主动订单指主动以对手方的报价进行成交，在卖一价买入，在买一价卖出。主动买卖最简单的例子就是 Market Order（市价单），市价单是以当前市场价格直接进入市场的一种订单。从交易的角度能够看出，市价单或者说主动买卖是一种非常积极的操作方法，更加理性的操作应该是在更高的价格卖出、在更低的价格买入。而市价单或者说主动买卖是用在低的价格卖出、高的价格买入来换取更早进入市场的机会。被动订单是指报价后等待对手方进行成交，在买一价买入，在卖一价卖出。主动买卖如果是市价单，那被动买卖就是 Limit Order（限价单）。当价格达到预设的位置，订单被动成交，这就是被动买卖。主动订单由于主动以对手方的价格成交，如果订单数量过大将对市场造成很大的冲击，导致市场价格发生较大变化。这种由于交易导致成交价格变化所引起的成本，叫作冲击成本。比如，需要买入 1000 万股某股票，前 500 万股主动与卖一价的 500 万股成交后，后 500 万股必须用更高的价格成交。被动订单由于需要等待对手方进行成交，成交时间不可控，因此需要付出的是机会成本。比如，虽然以买一价进行委托但没有成交，就可能会错过后续价格持续上涨。

# Q：何为滑点及其影响因素？何为冲击成本？

**一、何为滑点及其影响因素?**

滑点指交易者在决定交易开始到订单实际被执行这两个时间段之间的价格变化。常见的影响因素包括策略交易量、市场成交量、市场波动率、交易渠道匿名性、下单方式和策略收益实现速度。

由于策略的交易量通常大于平均盘口，导致交易价格与期望价格间之间存在差异，这种情况引发的成本为滑点成本。较高的成交量往往会加速标的价格变动的速率，从而产生较高的交易成本。

此外，滑点大小还取决于标的部分结构特征。市值风格、投资者结构等标的特征均可能对流动性产生影响，从而对滑点成本产生较直接的影响。对于管理规模较大的机构，由于自身交易量在市场交易量中占比较高，交易滑点对策略收益的影响尤为重要。

**二、冲击成本**

冲击成本全称“价格冲击成本”，可用来衡量股市的流动性，或称为流动性成本，指一定数量的委托（订单）迅速成交时对价格的影响——当把所有想买的仓位数量全部买到时，成本往往比一开始预想的要高——因此包含即时性和合理价格两方面要素的指标。

冲击成本包括滑点，也包括更长期对价格的影响——交易发生后会对市场造成一定程度的短期冲击，而经过一段时间的 “冷却期”后，市场价格会达到一个新的均衡，形成永久性的影响，即长期冲击。

根据《上海证券交易所市场质量报告（2023）》，近几年沪市价格冲击指数基本维持不变，交易10万元股票的价格冲击指数基本维持在15-16个基点，交易25万元、90万元的价格冲击指数则分别在 23-24、50-52个基点左右。华宝证券在金融工程报告《指数增强策略的舒适区在哪里?》中通过观察和测算，认为进入2023年以来，对于公募和私募指数增强产品而言，冲击成本整体呈下降趋势。

**三、不断丰富收益来源、分散持仓并优化订单执行以降低交易成本的影响**

交易成本可拆解为直接和间接两个组成部分，其中直接交易成本包括交易佣金和印花税、过户费等其他税费。在国内股票交易市场，普通投资者所需支付的费用主要有：证券交易佣金、证券过户费、证券交易监管费、证券交易经手费、印花税。自2023年8月28日起，证券交易印花税开始实施减半征收。

间接交易成本主要指包括滑点在内的冲击成本，与实际交易质量紧密关联。算法交易正是交易执行精细化发展的体现，确定订单最佳的执行路径、执行时间、执行价格及执行数量的交易方法（如将大单指令分割成众多小单指令），力争高效平稳地执行其交易指令、实现最优交易结果，有利于平滑对市场的冲击、降低交易成本。

买卖双方交易成本不同，一般来说买方交易端成本<卖方交易端成本，差异主要体现于印花税；而三大交易所收费标准也有所不同，北交所经手费率<沪深交易所经手费率。在证券持有环节，对于投资者持有收益仅征收股息红利税，且持有时间越长，税率相对越低，以体现鼓励中长期权益投资的导向。

对于有一定管理规模的资管机构而言，不断丰富收益来源、分散持仓并借助算法交易优化订单执行，有利于降低交易成本对超额收益的影响。此外，在行业超过万亿规模的背景下，各家量化私募管理人倾向于采用与自己当前管理规模相匹配的换手率。目前国内主流量化私募资管产品中，中周期策略（年换手率约30-50倍左右）占比较高，短周期策略占比逐步下降。随着规模提升，平均持仓周期还将进一步拉长。

# Q：算法交易如何降低交易成本

算法交易的目标主要有：交易成本最小化，如降低市场冲击成本；成本均价贴近目标价格，如市场成交均价；隐藏下单意图；其他非技术原因，如节约人力成本、提高下单效率、保障指令准确实现等。

常见的交易算法有 TWAP 和 VWAP。

TWAP 算法是通过拆分，使建仓成本与某段区间内的时间加权平均价格吻合。比如，需要在接下来的 3 个小时内购买 100 万股股票，算法会每隔 10 分钟买 1 次，3 个小时买 18 次，每次交易的数量是 1000000/18。TWAP 算法的优点是操作比较简单，比较适用于流动性比较好的个股或者规模比较小的交易；局限性是市场成交量是波动变化的，均匀分配固定的数量不够合理，盘中冲击比较大。

VWAP 算法的核心是最小化与市场实时成交量加权价格之间的差异，使得真实交易的执行价格最大限度地接近市场，从而降低冲击成本。VWAP 算法一般不直接对交易的冲击成本建模，而是注重日内交易量分布的预测，然后合理准确地对大额订单进行拆分和执行。比如，需要在某交易时间内执行大额交易，VWAP 算法首先会将这个交易时段划分成N个等长间隔，其次通过历史数据确定每个时间间隔内的成交量分布，然后按照成交量决定委托量。假设每笔委托都能达到成交效果，成交均价就可以最大限度地接近市场均价。